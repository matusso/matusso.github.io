<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>OSCE Prologue or How to get Secret key to CTP? :: .burso</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="If you want to register to CTP, you will need something they call Registration Code and Secret Key. So firstly, there is interesting file /fc4.js
function fc4me(srvstr) { if(!document.pleazfc4me.email.value || !document.pleazfc4me.securitystring.value) { alert(&amp;#34;Please fill in all the required fields!&amp;#34;); return false; } if(document.pleazfc4me.securitystring.value != hexMD5(&amp;#34;\x74\x72\x79\x68\x61\x72\x64\x65\x72&amp;#34;&#43;srvstr)) { alert(&amp;#34;Registration Authorization String not accepted! Try Harder! &amp;#34;); return false; } else { document.pleazfc4me.submit(); } } So all you need to do is setup some js variables in browser console and call fc4me(srvstr)"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/osce-prologue/" />


<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/green.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/favicon.jpg">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="OSCE Prologue or How to get Secret key to CTP? :: .burso — " />
<meta name="twitter:description" content="If you want to register to CTP, you will need something they call Registration Code and Secret Key. So firstly, there is interesting file /fc4.js
function fc4me(srvstr) { if(!document.pleazfc4me.email.value || !document.pleazfc4me.securitystring.value) { alert(&amp;#34;Please fill in all the required fields!&amp;#34;); return false; } if(document.pleazfc4me.securitystring.value != hexMD5(&amp;#34;\x74\x72\x79\x68\x61\x72\x64\x65\x72&amp;#34;&#43;srvstr)) { alert(&amp;#34;Registration Authorization String not accepted! Try Harder! &amp;#34;); return false; } else { document.pleazfc4me.submit(); } } So all you need to do is setup some js variables in browser console and call fc4me(srvstr)" />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="OSCE Prologue or How to get Secret key to CTP? :: .burso — ">
<meta property="og:description" content="If you want to register to CTP, you will need something they call Registration Code and Secret Key. So firstly, there is interesting file /fc4.js
function fc4me(srvstr) { if(!document.pleazfc4me.email.value || !document.pleazfc4me.securitystring.value) { alert(&amp;#34;Please fill in all the required fields!&amp;#34;); return false; } if(document.pleazfc4me.securitystring.value != hexMD5(&amp;#34;\x74\x72\x79\x68\x61\x72\x64\x65\x72&amp;#34;&#43;srvstr)) { alert(&amp;#34;Registration Authorization String not accepted! Try Harder! &amp;#34;); return false; } else { document.pleazfc4me.submit(); } } So all you need to do is setup some js variables in browser console and call fc4me(srvstr)" />
<meta property="og:url" content="/posts/osce-prologue/" />
<meta property="og:site_name" content="OSCE Prologue or How to get Secret key to CTP?" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2020-01-22 14:32:59 &#43;0100 CET" />











</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    0x90
  </div>
</a>

    </div>
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/posts/osce-prologue/">OSCE Prologue or How to get Secret key to CTP?</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2020-01-22
    </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/offensive-security/">offensive-security</a>&nbsp;
    
    #<a href="/tags/hacking/">hacking</a>&nbsp;
    
    #<a href="/tags/ctf/">ctf</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <p>If you want to register to CTP, you will need something they call Registration Code and Secret Key.  So firstly, there is interesting file <strong>/fc4.js</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fc4me</span>(<span style="color:#a6e22e">srvstr</span>) {
  
   <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">securitystring</span>.<span style="color:#a6e22e">value</span>) {
      <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;Please fill in all the required fields!&#34;</span>);
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
   }
   <span style="color:#66d9ef">if</span>(document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">securitystring</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">hexMD5</span>(<span style="color:#e6db74">&#34;\x74\x72\x79\x68\x61\x72\x64\x65\x72&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">srvstr</span>)) {
      <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;Registration Authorization String not accepted! Try Harder! &#34;</span>);
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    } <span style="color:#66d9ef">else</span> {
      document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">submit</span>();
    }
   
}
</code></pre></div><p>So all you need to do is setup some js variables in browser console and call <strong>fc4me(srvstr)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">srvstr</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Thursday 23rd of January 2020&#39;</span>;
document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">securitystring</span>.<span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#a6e22e">hexMD5</span>(<span style="color:#e6db74">&#34;\x74\x72\x79\x68\x61\x72\x64\x65\x72&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">srvstr</span>);
document.<span style="color:#a6e22e">pleazfc4me</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&lt;your_email_address&gt;&#34;</span>;
<span style="color:#a6e22e">fc4me</span>(<span style="color:#a6e22e">srvstr</span>);
</code></pre></div><p>After that you will obtain something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">RW1haWw6IDx5b3VyX2VtYWlsX2FkZHJlc3M+ICwgUmVnaXN0cmF0aW9uIENvZGU6IDx5b3VyX3Jl
Z2lzdHJhdGlvbl9udW1iZXI+IHwgTm93IGRlY29kZSB5b3VyIENUUCBTZWNyZXQgS2V5IGFuZCB5
b3UgYXJlIGRvbmUhIDogXHgzMVx4QzBceDUwXHg2OFx4MjRceDc3XHg3NVx4NzFceDY4XHg3NVx4
MjNceDc5XHgyMFx4NjhceDc4XHg3Nlx4MjRceDI1XHg2OFx4NzVceDc2XHgyMlx4MjNceDY4XHg3
N1x4NzdceDc2XHg3NVx4NjhceDc1XHgyNFx4MjVceDc0XHg2OFx4MjdceDI3XHgyMFx4MjJceDY4
XHgyNFx4NzRceDIzXHgyM1x4NjhceDIwXHg3M1x4NzFceDIwXHg2OFx4NzBceDczXHg3OVx4Nzdc
eDY4XHg3OFx4NzZceDIzXHgyMFx4NjhceDc2XHgyNVx4MjVceDIyXHg2OFx4NzJceDczXHgyN1x4
NzRceDY4XHgyN1x4NzBceDc1XHg3NVx4NjhceDIwXHgyNFx4MjRceDI3XHg2OFx4NzlceDcyXHg3
Nlx4NzVceDY4XHg3N1x4NzNceDc5XHgyN1x4NjhceDI0XHgyMFx4NzRceDc3XHg2OFx4MjdceDIw
XHg3NFx4MjJceDY4XHgyNVx4NzdceDIwXHg3OFx4NjhceDc1XHg3Mlx4NzlceDc0XHg2OFx4NzVc
eDI0XHgyM1x4NzJceDY4XHg3Nlx4MjdceDI0XHgyNFx4NjhceDIyXHg3OVx4NzdceDczXHg2OFx4
NzRceDc5XHg3OFx4MjBceDY4XHgyNVx4MjVceDc2XHg3NFx4NjhceDI1XHg3NFx4NzFceDc2XHg2
OFx4MjdceDc1XHgyM1x4MjNceDY4XHgyNFx4MjJceDIwXHg3N1x4NjhceDIyXHgyNVx4NzNceDc4
XHg2OFx4NzNceDIzXHg3NVx4NzZceDY4XHg3M1x4NzNceDc1XHgyNVx4NTRceDVFXHg4Qlx4RkVc
eDhCXHhEN1x4RkNceEI5XHg4MFx4MDBceDAwXHgwMFx4QkJceDQxXHgwMFx4MDBceDAwXHgzMVx4
QzBceDUwXHhBQ1x4MzNceEMzXHhBQVx4RTJceEZBXHg1NFx4NUVceEND
</code></pre></div><p>Looks like <strong>BASE64</strong> encoded text, so we can copy text to file and try to decode it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat encoded_raw | base64 -d
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Email: &lt;your_email_address&gt; , Registration Code: &lt;your_registration_number&gt; | 
Now decode your CTP Secret Key and you are <span style="color:#66d9ef">done</span>! : 
<span style="color:#ae81ff">\x</span>31<span style="color:#ae81ff">\x</span>C0<span style="color:#ae81ff">\x</span>50<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>71<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>78<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">68</span>
<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">22</span>
<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>71<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>70<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>78<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">23</span>
<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>72<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>70<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">24</span>
<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>72<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">27</span>
<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>78<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>72<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>72<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">68</span>
<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>79<span style="color:#ae81ff">\x</span>78<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">74</span>
<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>74<span style="color:#ae81ff">\x</span>71<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>27<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>24<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>77<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>22<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">73</span>
<span style="color:#ae81ff">\x</span>78<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>23<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>76<span style="color:#ae81ff">\x</span>68<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>73<span style="color:#ae81ff">\x</span>75<span style="color:#ae81ff">\x</span>25<span style="color:#ae81ff">\x</span>54<span style="color:#ae81ff">\x</span>5E<span style="color:#ae81ff">\x</span>8B<span style="color:#ae81ff">\x</span>FE<span style="color:#ae81ff">\x</span>8B<span style="color:#ae81ff">\x</span>D7<span style="color:#ae81ff">\x</span>FC<span style="color:#ae81ff">\x</span>B9
<span style="color:#ae81ff">\x</span>80<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>BB<span style="color:#ae81ff">\x</span>41<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>00<span style="color:#ae81ff">\x</span>31<span style="color:#ae81ff">\x</span>C0<span style="color:#ae81ff">\x</span>50<span style="color:#ae81ff">\x</span>AC<span style="color:#ae81ff">\x</span>33<span style="color:#ae81ff">\x</span>C3<span style="color:#ae81ff">\x</span>AA<span style="color:#ae81ff">\x</span>E2<span style="color:#ae81ff">\x</span>FA<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">54</span>
<span style="color:#ae81ff">\x</span>5E<span style="color:#ae81ff">\x</span>CC
</code></pre></div><p>It is something like binary blob, let&rsquo;s <a href="https://duckduckgo.com/?q=%5Cx31%5Cxc0">search it</a>.
After searching we can think about <strong>shellcode</strong>. So let&rsquo;s save it to file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -c <span style="color:#e6db74">&#39;import sys; sys.stdout.buffer.write(b&#34;\x31\xC0\x50\x68\x24\x77\x75\x71\x68\x75\x23\x79\x20\x68\x78\x76\x24\x25\x68\x75\x76\x22\x23\x68\x77\x77\x76\x75\x68\x75\x24\x25\x74\x68\x27\x27\x20\x22\x68\x24\x74\x23\x23\x68\x20\x73\x71\x20\x68\x70\x73\x79\x77\x68\x78\x76\x23\x20\x68\x76\x25\x25\x22\x68\x72\x73\x27\x74\x68\x27\x70\x75\x75\x68\x20\x24\x24\x27\x68\x79\x72\x76\x75\x68\x77\x73\x79\x27\x68\x24\x20\x74\x77\x68\x27\x20\x74\x22\x68\x25\x77\x20\x78\x68\x75\x72\x79\x74\x68\x75\x24\x23\x72\x68\x76\x27\x24\x24\x68\x22\x79\x77\x73\x68\x74\x79\x78\x20\x68\x25\x25\x76\x74\x68\x25\x74\x71\x76\x68\x27\x75\x23\x23\x68\x24\x22\x20\x77\x68\x22\x25\x73\x78\x68\x73\x23\x75\x76\x68\x73\x73\x75\x25\x54\x5E\x8B\xFE\x8B\xD7\xFC\xB9\x80\x00\x00\x00\xBB\x41\x00\x00\x00\x31\xC0\x50\xAC\x33\xC3\xAA\xE2\xFA\x54\x5E\xCC&#34;)&#39;</span> &gt; shellcode
$ ndisasm -b <span style="color:#ae81ff">32</span> shellcode &gt; shellcode.asm
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat shellcode.asm
<span style="color:#ae81ff">00000000</span>  31C0              xor eax,eax
<span style="color:#ae81ff">00000002</span>  <span style="color:#ae81ff">50</span>                push eax
<span style="color:#ae81ff">00000003</span>  <span style="color:#ae81ff">6824777571</span>        push dword 0x71757724
<span style="color:#ae81ff">00000008</span>  <span style="color:#ae81ff">6875237920</span>        push dword 0x20792375
0000000D  <span style="color:#ae81ff">6878762425</span>        push dword 0x25247678
<span style="color:#ae81ff">00000012</span>  <span style="color:#ae81ff">6875762223</span>        push dword 0x23227675
<span style="color:#ae81ff">00000017</span>  <span style="color:#ae81ff">6877777675</span>        push dword 0x75767777
0000001C  <span style="color:#ae81ff">6875242574</span>        push dword 0x74252475
<span style="color:#ae81ff">00000021</span>  <span style="color:#ae81ff">6827272022</span>        push dword 0x22202727
<span style="color:#ae81ff">00000026</span>  <span style="color:#ae81ff">6824742323</span>        push dword 0x23237424
0000002B  <span style="color:#ae81ff">6820737120</span>        push dword 0x20717320
<span style="color:#ae81ff">00000030</span>  <span style="color:#ae81ff">6870737977</span>        push dword 0x77797370
<span style="color:#ae81ff">00000035</span>  <span style="color:#ae81ff">6878762320</span>        push dword 0x20237678
0000003A  <span style="color:#ae81ff">6876252522</span>        push dword 0x22252576
0000003F  <span style="color:#ae81ff">6872732774</span>        push dword 0x74277372
<span style="color:#ae81ff">00000044</span>  <span style="color:#ae81ff">6827707575</span>        push dword 0x75757027
<span style="color:#ae81ff">00000049</span>  <span style="color:#ae81ff">6820242427</span>        push dword 0x27242420
0000004E  <span style="color:#ae81ff">6879727675</span>        push dword 0x75767279
<span style="color:#ae81ff">00000053</span>  <span style="color:#ae81ff">6877737927</span>        push dword 0x27797377
<span style="color:#ae81ff">00000058</span>  <span style="color:#ae81ff">6824207477</span>        push dword 0x77742024
0000005D  <span style="color:#ae81ff">6827207422</span>        push dword 0x22742027
<span style="color:#ae81ff">00000062</span>  <span style="color:#ae81ff">6825772078</span>        push dword 0x78207725
<span style="color:#ae81ff">00000067</span>  <span style="color:#ae81ff">6875727974</span>        push dword 0x74797275
0000006C  <span style="color:#ae81ff">6875242372</span>        push dword 0x72232475
<span style="color:#ae81ff">00000071</span>  <span style="color:#ae81ff">6876272424</span>        push dword 0x24242776
<span style="color:#ae81ff">00000076</span>  <span style="color:#ae81ff">6822797773</span>        push dword 0x73777922
0000007B  <span style="color:#ae81ff">6874797820</span>        push dword 0x20787974
<span style="color:#ae81ff">00000080</span>  <span style="color:#ae81ff">6825257674</span>        push dword 0x74762525
<span style="color:#ae81ff">00000085</span>  <span style="color:#ae81ff">6825747176</span>        push dword 0x76717425
0000008A  <span style="color:#ae81ff">6827752323</span>        push dword 0x23237527
0000008F  <span style="color:#ae81ff">6824222077</span>        push dword 0x77202224
<span style="color:#ae81ff">00000094</span>  <span style="color:#ae81ff">6822257378</span>        push dword 0x78732522
<span style="color:#ae81ff">00000099</span>  <span style="color:#ae81ff">6873237576</span>        push dword 0x76752373
0000009E  <span style="color:#ae81ff">6873737525</span>        push dword 0x25757373
000000A3  <span style="color:#ae81ff">54</span>                push esp
000000A4  5E                pop esi
000000A5  8BFE              mov edi,esi
000000A7  8BD7              mov edx,edi
000000A9  FC                cld
000000AA  B980000000        mov ecx,0x80
000000AF  BB41000000        mov ebx,0x41
000000B4  31C0              xor eax,eax
000000B6  <span style="color:#ae81ff">50</span>                push eax
000000B7  AC                lodsb
000000B8  33C3              xor eax,ebx
000000BA  AA                stosb
000000BB  E2FA              loop 0xb7
000000BD  <span style="color:#ae81ff">54</span>                push esp
000000BE  5E                pop esi
000000BF  CC                int3
</code></pre></div><p>Now we have to edit the file before we can assemble it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ awk <span style="color:#e6db74">&#39;{$1=$2=&#34;&#34;; print $0}&#39;</span> shellcode.asm | sed <span style="color:#e6db74">&#39;s/^  //g&#39;</span> &gt; shellcode_edited.asm
</code></pre></div><p>Save diff to patch file <strong>shellcode.patch</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-patch" data-lang="patch"><span style="color:#f92672">--- shellcode.asm	2020-01-23 12:29:31.345434907 +0100
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+++ shellcode_diff.asm	2020-01-23 12:28:09.689429680 +0100
</span><span style="color:#a6e22e"></span><span style="color:#75715e">@@ -1,3 +1,5 @@
</span><span style="color:#75715e"></span><span style="color:#a6e22e">+global _start
</span><span style="color:#a6e22e">+_start:
</span><span style="color:#a6e22e"></span> xor eax,eax
 push eax
 push dword 0x71757724
<span style="color:#75715e">@@ -41,10 +43,11 @@
</span><span style="color:#75715e"></span> mov ebx,0x41
 xor eax,eax
 push eax
<span style="color:#a6e22e">+decode:
</span><span style="color:#a6e22e"></span> lodsb
 xor eax,ebx
 stosb
<span style="color:#f92672">-loop 0xb7
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+loop decode
</span><span style="color:#a6e22e"></span> push esp
 pop esi
 int3
</code></pre></div><p>And apply the following patch. Then we can assemble it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ patch &lt; shellcode.patch
$ nasm -f elf shellcode.asm
$ ld -m elf_i386 -o key_ed shellcode.o
</code></pre></div><p>Finally let&rsquo;s find the <strong>secret key</strong>!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gdb ./key_ed
<span style="color:#66d9ef">$(</span>gdb<span style="color:#66d9ef">)</span> r
<span style="color:#66d9ef">$(</span>gdb<span style="color:#66d9ef">)</span> x/s $edx
0xffffdbec:	<span style="color:#e6db74">&#34;224d2b47cd29eca6f4bbd507dd75589ac8627fee4eb34385d6a9fa5cea56628f8374aeeff14432f57ddc97ba1286a20ae5bbffac4ed5667447cb97ed4b8ae640&#34;</span>
</code></pre></div>
  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h"></span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <span class="button previous">
        <a href="/posts/citrix-vulnerability/">
          <span class="button__icon">←</span>
          <span class="button__text">How find a vulnerable server on the internet?</span>
        </a>
      </span>
      
      
      <span class="button next">
        <a href="/posts/34c3-tuwat/">
          <span class="button__text">Notes from #34c3</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2020 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
